<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
  <maintainer type="person">
    <!-- Ebuild on the oiledmachine-overlay -->
    <email>orsonteodoro@hotmail.com</email>
    <name>Orson Teodoro</name>
  </maintainer>
  <maintainer type="project">
    <!-- Ebuild originator -->
    <email>chromium@gentoo.org</email>
    <name>Chromium in Gentoo Project</name>
  </maintainer>
  <maintainer type="person">
    <!-- Distro ebuild contributor -->
    <email>kangie@gentoo.org</email>
    <name>Matt Jolly</name>
  </maintainer>
  <!--

    oiledmachine-overlay notes:

    Chromium is a open-source web browser.

    For this ebuild fork, you can build 32 bit Chromium on 64 bit.  Multiple ABI
    installation is in testing.  This will allow to use binary only plugins that
    support a major ABI and allow to continue to use the experimental ABI as the
    default.

    You need to add the following in /etc/portage/profile/package.use.force
    in order to select a non-native ABI.  Tweak below to add your masked ABI.
    ----- CUT BELOW HERE -----
www-client/chromium -abi_x86_64 -abi_x86_32 -abi_x86_x32 -abi_mips_n64 -abi_ppc_64 -abi_s390_64
    ----- CUT ABOVE HERE -----

    To override the distro hard mask for ffmpeg5 do the following:

      mkdir -p /etc/portage/profile
      echo "www-client/chromium -system-ffmpeg" >> /etc/portage/profile/package.use.mask


    Per-package environment variables:

    FORCE_LLVM_SLOT - Manually choose the LLVM slot to build with

    See https://wiki.gentoo.org/wiki//etc/portage/package.env to set this up

    MITIGATION_USE_CASE - Sets the safety period for ebuild (re-)installs.  If
    the duration exceeds, the ebuild will not (re-)install until a newer point
    release is provided by upstream.
    Valid values:
      donations - 1 week
      email     - 1 week
      legal     - 1 week
      money     - 1 week
      shopping  - 1 week
      socials   - 2 weeks (ebuild default)
      default   - 30 days
    Examples:
      MITIGATION_USE_CASE="shopping"           # The ebuild is (re-)installable for 1 week from release date.
      MITIGATION_USE_CASE="donations socials"  # The ebuild is (re-)installable for 1 week from release date.
      MITIGATION_USE_CASE="socials"            # The ebuild is (re-)installable for 2 weeks from release date.
      MITIGATION_USE_CASE="default"            # The ebuild is (re-)installable for 30 days from release date but may likely contain vulnerabilities.


    USE flag quality status:

      cfi - production ready
      mold - testing
      official - production ready previously but undergoing retesting
      pgo - production ready
      shadowcallstack - needs testing... not tested due to lack of hardware
        (report back if it works)
      thinlto-opt - works if enough total memory


    PartitionAlloc - a secure allocator

      Chromium uses PartitionAlloc as the default allocator.  It's designed for
      security to avoid type confusion attacks and lower latency, and benefits
      the most from memory use effiency.  It's the default in 92 and later.
      There is no current way to switch back to the OS allocator.


    Build time environment variables:

      APPLY_OILEDMACHINE_OVERLAY_PATCHSET - Apply the following patches:
      - Allow for Qt6 build without Qt5.
      - Allow to disable SIMD for zlib for compatibility with older CPUs.
      Valid values:  1 - apply (default), 0 - do not apply

      ULIMIT - Sets the max number of open file descriptors.
      Defaults:  Mold - 16384,  BFD/LLD - 2048

    References:
      --lto-O2 is too large - https://github.com/chromium/chromium/commit/da072d13b2a1cc8459c29aa4e52584a4491a4ad6
      CFI - https://www.chromium.org/developers/testing/control-flow-integrity
      CFI ldflags - https://clang.llvm.org/docs/ControlFlowIntegrity.html
      PartitionAlloc - https://chromium.googlesource.com/chromium/src/+/refs/heads/main/base/allocator/partition_allocator/PartitionAlloc.md
      PGO - https://blog.chromium.org/2020/08/chrome-just-got-faster-with-profile.html
      https://github.com/chromium/chromium/blob/master/build/config/sanitizers/BUILD.gn#L204
      [1] https://github.com/chromium/chromium/tree/master/tools/perf/benchmarks
      [2] https://chromium.googlesource.com/catapult/+/HEAD/telemetry/README.md
  -->
  <upstream>
    <bugs-to>https://www.chromium.org/for-testers/bug-reporting-guidelines</bugs-to>
    <remote-id type="github">chromium/chromium</remote-id>
    <remote-id type="gitlab">Matt.Jolly/chromium-patches</remote-id>
  </upstream>
  <use>
    <flag name="bluetooth">
      Adds support for websites to communicate with Bluetooth wireless devices
      and support for GATT (Generic Attribute Profile) for the Web Bluetooth
      API.
    </flag>
    <flag name="branch-protection">
      Enables branch protection features (available on armv8.5 [arm64] and above
      only) which are enabled by default.  If you disable the official USE flag,
      you may customize it via CFLAGS with your preference prioritized more than
      the official settings.
    </flag>
    <flag name="bundled-libcxx">
      Build against the internal libc++ for proper cfi-icall and cfi-icast
      protection.  This also builds libcxx with CFI, Full RELRO, noexecstack,
      SSP security features.  This is the upstream default.
    </flag>
    <flag name="cfi">
      cfi-cast:
      Compile the build with mitigation against possible bad casting
      vulnerabilities.  When a violation is encountered, the program aborts.

      cfi-icall:
      Compile the build with bad function cast checks and non static function
      pointers checks.  When a violation is encountered, the program aborts.

      cfi-vcall:
      Compile the build with Clang Control Flow Integrity (CFI) security
      protections to mitigate against arbitrary code execution caused by from
      memory corruption attempts from forward edge attacks from virtual
      functions.  For backward edge protection see shadowcallstack USE flag.
      The estimated impact is around 1% CPU overhead, around 15% or less code
      size increase.  When a violation is encountered, the program aborts.

      The abort is a way to halt more dangerous code execution.

      shadow-call-stack:
      Allows for backward edge protections against return address overwrites
      that could lead to arbitrary code execution.  (Experimental, arm64 only)
      Use -fsanitize=shadow-call-stack to activate this protection.

      Arm64 users, see also the branch-protection USE flag.

      Additional ebuild per-package environment variables if USE=-official:

        USE_CFI_ICALL - 1 to enable, 0 to disable cfi-icall
        USE_CFI_CAST - 1 to enable, 0 to disable cfi-cast

      For the official build settings, it is fixed based on the ABI.

      For x86-64 it is cfi-vcall=true, cfi-icall=true, cfi-cast=false
      All other microarches are all false, but you may customize via the
      -fsanitize= compiler flag with the cfi USE flag.
    </flag>
    <flag name="component-build">
      Split build into more shared libraries to speed up linking. Mostly
      intended for debugging and development, NOT RECOMMENDED for general use.
    </flag>
    <flag name="hangouts">
      Enable support for Hangouts and features such as screen sharing
    </flag>
    <flag name="headless">
      Build Ozone only with headless backend, NOT RECOMMENDED for general use.
    </flag>
    <flag name="js-type-check">
      Enable JavaScript type-checking for Chrome's web technology-based UI.
      Requires Java.
    </flag>
    <flag name="mold">
      Use the mold linker to decrease linking times.
    </flag>
    <flag name="official">
      Enable the use of official build settings [similar to the official bin but
      without branding] instead of the developer build settings.  Enables
      security hardending (for both the browser and internal bundled third party
      dependencies built with the stronger CFI Basic mode with cfi-vcall and
      cfi-icall [both enabled on x86_64], Full RELRO, noexecstack, PIE, SSP),
      PGO, debug symbols level 2.  Disables use of third party ebuilds (without
      CFI and PGO) and uses the internal bundled hardened and PGOed version of
      those libraries with static linkage.  Implies default features and
      proprietary-codecs.
    </flag>
    <flag name="pax-kernel">
      Allow building on a PaX-enabled kernel
    </flag>
    <flag name="pic">
      Disable optimized assembly code that is not PIC friendly
    </flag>
    <flag name="pgo">
      Builds in one step with Profile Guided Optimizations to improve -- page
      loads, input reponsiveness, web reponsiveness -- by ~10% or less, using a
      pregenerated PGO profile.
    </flag>
    <flag name="pre-check-llvm">
      Disables LLVM commit checks.  It is not recommended to disable the commit
      tests that notify commit bumps related to security or bugs.
    </flag>
    <flag name="pre-check-vaapi">
      Disables non-portable native VAAPI checks.  It is not recommended to
      disable these checks because they can expose bugs.
    </flag>
    <flag name="proprietary-codecs">
      Enables use of non-free patent-encumbered audio, formats, video formats,
      and network protocols.  Upstream build files associate AAC, H264, and
      others as proprietary.
    </flag>
    <flag name="proprietary-codecs-disable">
      (USE FLAG IN DEVELOPMENT)

      If enabled, it will disable codecs or network protocols with a patent
      status that is not free in this ebuild fork.

      With this flag enabled, this may break dependencies that assume previous
      unpatched behavior.

      In general a codec is allowed to be built into disabled proprietary-codecs
      build if the patent status is one of the following:

        (1) Expired patent, typically 20 years.  (e.g. MP3)
        (2) Similar perpetual royalty-free freedoms like the
            Grant of Patent License in the Apache 2.0. (e.g. libvpx, libaom)

      AND

        The code is free with a widely used compatible open source license.

      AND CONDITIONALLY

        The codec may allowed in this ebuild fork if it doesn't require a
        non-free developer license in a case-by-case basis.

    </flag>
    <flag name="proprietary-codecs-disable-nc-developer">
      (USE FLAG IN DEVELOPMENT)

      If enabled, it will disable codecs or network protocols with a patent
      status that is not free in this ebuild fork for codec developers for
      non-commericial use.

      With this flag enabled, this may break dependencies that assume previous
      unpatched behavior.

      In general a codec is allowed to be built into disabled proprietary-codecs
      build if the patent status is one of the following:

        (1) Expired patent, typically 20 years.  (e.g. MP3)
        (2) Similar perpetual royalty-free freedoms like the
            Grant of Patent License in the Apache 2.0. (e.g. libvpx, libaom)

      AND

        The code is free with a widely used compatible open source license.

      AND CONDITIONALLY

        The codec may allowed in this ebuild fork if it doesn't require a
        non-free developer license in a case-by-case basis.

    </flag>
    <flag name="proprietary-codecs-disable-nc-user">
      (USE FLAG IN DEVELOPMENT)

      If enabled, it will disable codecs or network protocols with a patent
      status that is not free in this ebuild fork for non codec developers
      for non-commercial use.

      With this flag enabled, this may break dependencies that assume previous
      unpatched behavior.

      In general a codec is allowed to be built into disabled proprietary-codecs
      build if the patent status is one of the following:

        (1) Expired patent, typically 20 years.  (e.g. MP3)
        (2) Similar perpetual royalty-free freedoms like the
            Grant of Patent License in the Apache 2.0. (e.g. libvpx, libaom)

      AND

        The code is free with a widely used compatible open source license.

      AND CONDITIONALLY

        The codec may allowed in this ebuild fork if it doesn't require a
        non-free developer license in a case-by-case basis.

    </flag>
    <flag name="qt5">
      Enable qt5 support
    </flag>
    <flag name="qt6">
      Enable qt6 support
    </flag>
    <flag name="screencast">
      Enable support for remote desktop and screen cast using
      <pkg>media-video/pipewire</pkg>
    </flag>
    <flag name="suid">
      Build the SUID sandbox, which is only needed on CONFIG_USER_NS=n kernels
    </flag>
    <flag name="system-dav1d">
      Use system dav1d instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-ffmpeg">
      Use system ffmpeg instead of the bundled one

      The internal vendered version has additional codecs that are not
      removeable, but the system one may be able to remove them.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-flac">
      Use system flac instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-fontconfig">
      Use system fontconfig instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-harfbuzz">
      Use system harfbuzz instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-icu">
      Use system icu instead of the bundled one

      The internal vendored version has bug fixes, size reduced, adds spell check
      support few languages, locale style changes related to
      time/currency/regions/number-represenation.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libaom">
      Use system libaom instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libdrm">
      Use system libdrm instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libjpeg-turbo">
      Use system libjpeg-turbo instead of the bundled one

      Vendored applies data de-duplication change and removes non-performant
      ARM neon assembly.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libpng">
      Use system libpng instead of the bundled one

      Vendored applies a patch to potentially prevent slow down or abuse.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libstdcxx">
      Build against the system's libstdc++ for compatibility reasons which
      is protected with CET (if supported by CPU, similar to CFI).  This could
      increase the attack surface and possibly an open door for arbitary code
      execution for untrusted assets.  It is not recommended for security
      reasons but it is the original ebuild maintainers and this distro's
      preference.  This setting is only allowed for systemwide GCC LTO due
      to IR (Intermediate Representation) compatibility or disabled LTO
      systemwide.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libwebp">
      Use system libwebp instead of the bundled one

      No modifications or no patch files in vendored package.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libxml">
      Use system libxml instead of the bundled one

      Applies a vulnerabilty fix.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-libxslt">
      Use system libxslt instead of the bundled one

      Applies fixes for testing or built time failures.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-openh264">
      Use system openh264 instead of the bundled one

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-opus">
      Use system opus instead of the bundled one

      Applies disablement to assertions or int overflow checks.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-re2">
      Use system re2 instead of the bundled one

      No modifications announced.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="system-toolchain">
      Use the system-clang and system-rust instead of the bundled one.

      If disabled, it will build with a pre-stable build of Clang and a post
      snapshot of Rust.
    </flag>
    <flag name="system-zlib">
      Use system zlib instead of the bundled one

      The internal vendored version is SIMD optimized but the vanilla zlib provided
      by the system is not.

      Enabling may decrease performance (w/o PGO) and increase vulnerabilities
      (w/o Clang CFI).
    </flag>
    <flag name="thinlto-opt">
      Enables selective ThinLTO -O2 optimizations for the browser binary and
      other targets while others use the default --lto-O0.  This optimization
      is not enabled by default upstream due to increased binary size concerns.
      Building may required 12 GiB total memory minimal for dedicated compile
      only machines, but 16 GiB total memory recommended for multitasking
      builder machines.
    </flag>
    <flag name="vaapi">
      Add support for hardware accelerated JPEG image decoding, hardware
      accelerated video decoding playback, and hardware accelerated video
      encoding for WebRTC
    </flag>
    <flag name="weston">
      Prefer weston to generate wayland PGO profile.  This option is mutually
      exclusive to X windowing system PGO profile generation
    </flag>
    <flag name="widevine">
      Unsupported closed-source DRM capability (required for premium web
      content).
    </flag>
    <flag name="rN">
      (FOR INTERNAL USE ONLY) Bumps the revision through the USE flag instead of
      file name to reuse previous ccache runs.
    </flag>

    <!-- Codecs and network protocols -->
    <flag name="dav1d">
      Add CPU based AV1 video decode support
    </flag>
    <flag name="libaom">
      Add CPU based libaom encode support
    </flag>
    <flag name="opus">
      Add CPU based Opus audio codec support
    </flag>
    <flag name="vpx">
      Add CPU based libvpx video codec support
    </flag>
    <flag name="vaapi-hvec">
      Add GPU accelerated h265 video decode support
    </flag>
  </use>
</pkgmetadata>
