--- a/third_party/dav1d/BUILD.gn.orig	2025-05-08 00:13:34.892300722 -0700
+++ b/third_party/dav1d/BUILD.gn	2025-05-08 00:14:40.872634383 -0700
@@ -6,6 +6,7 @@ import("dav1d_generated.gni")
 
 import("//build/config/compiler/compiler.gni")
 import("//build/config/sanitizers/sanitizers.gni")
+import("//build/config/simd.gni")
 import("//third_party/nasm/nasm_assemble.gni")
 
 declare_args() {
@@ -147,7 +148,16 @@ if (is_clang && (current_cpu == "arm" ||
 
 if (enable_nasm) {
   nasm_assemble("dav1d_asm") {
-    sources = x86_asm_sources
+    sources = x86_asm_sources_common
+    if (use_sse) {
+      sources += x86_asm_sources_sse
+    }
+    if (use_avx2) {
+      sources += x86_asm_sources_avx2
+    }
+    if (use_avx512) {
+      sources += x86_asm_sources_avx512
+    }
 
     inputs = [
       "$platform_config_root/config.asm",
@@ -316,7 +326,9 @@ static_library("dav1d") {
   if (current_cpu == "x86" || current_cpu == "x64") {
     deps += [ ":dav1d_x86" ]
     if (enable_nasm) {
-      deps += [ ":dav1d_asm" ]
+      if (use_sse || use_avx2 || use_avx512) {
+        deps += [ ":dav1d_asm" ]
+      }
     }
   } else if (current_cpu == "arm" || current_cpu == "arm64") {
     deps += [ ":dav1d_arm" ]
--- a/third_party/dav1d/dav1d_generated.gni.orig	2025-05-08 00:13:34.892549520 -0700
+++ b/third_party/dav1d/dav1d_generated.gni	2025-05-08 00:14:39.416650212 -0700
@@ -4,50 +4,58 @@
 
 # NOTE: this file is autogenerated by dav1d/generate_sources.py - DO NOT EDIT.
 
-x86_asm_sources = [
-  "libdav1d/src/x86/cdef16_avx2.asm",
-  "libdav1d/src/x86/cdef16_avx512.asm",
+import("//build/config/simd.gni")
+
+x86_asm_sources_sse = [
   "libdav1d/src/x86/cdef16_sse.asm",
-  "libdav1d/src/x86/cdef_avx2.asm",
-  "libdav1d/src/x86/cdef_avx512.asm",
   "libdav1d/src/x86/cdef_sse.asm",
-  "libdav1d/src/x86/cpuid.asm",
-  "libdav1d/src/x86/filmgrain16_avx2.asm",
-  "libdav1d/src/x86/filmgrain16_avx512.asm",
   "libdav1d/src/x86/filmgrain16_sse.asm",
-  "libdav1d/src/x86/filmgrain_avx2.asm",
-  "libdav1d/src/x86/filmgrain_avx512.asm",
   "libdav1d/src/x86/filmgrain_sse.asm",
-  "libdav1d/src/x86/ipred16_avx2.asm",
-  "libdav1d/src/x86/ipred16_avx512.asm",
   "libdav1d/src/x86/ipred16_sse.asm",
-  "libdav1d/src/x86/ipred_avx2.asm",
-  "libdav1d/src/x86/ipred_avx512.asm",
   "libdav1d/src/x86/ipred_sse.asm",
-  "libdav1d/src/x86/itx16_avx2.asm",
-  "libdav1d/src/x86/itx16_avx512.asm",
   "libdav1d/src/x86/itx16_sse.asm",
-  "libdav1d/src/x86/itx_avx2.asm",
-  "libdav1d/src/x86/itx_avx512.asm",
   "libdav1d/src/x86/itx_sse.asm",
-  "libdav1d/src/x86/loopfilter16_avx2.asm",
-  "libdav1d/src/x86/loopfilter16_avx512.asm",
   "libdav1d/src/x86/loopfilter16_sse.asm",
-  "libdav1d/src/x86/loopfilter_avx2.asm",
-  "libdav1d/src/x86/loopfilter_avx512.asm",
+  "libdav1d/src/x86/looprestoration16_sse.asm",
   "libdav1d/src/x86/loopfilter_sse.asm",
+  "libdav1d/src/x86/looprestoration_sse.asm",
+  "libdav1d/src/x86/mc16_sse.asm",
+  "libdav1d/src/x86/mc_sse.asm",
+]
+x86_asm_sources_avx2 = [
+  "libdav1d/src/x86/cdef16_avx2.asm",
+  "libdav1d/src/x86/cdef_avx2.asm",
+  "libdav1d/src/x86/filmgrain16_avx2.asm",
+  "libdav1d/src/x86/filmgrain_avx2.asm",
+  "libdav1d/src/x86/ipred16_avx2.asm",
+  "libdav1d/src/x86/ipred_avx2.asm",
+  "libdav1d/src/x86/itx16_avx2.asm",
+  "libdav1d/src/x86/itx_avx2.asm",
+  "libdav1d/src/x86/loopfilter16_avx2.asm",
+  "libdav1d/src/x86/loopfilter_avx2.asm",
   "libdav1d/src/x86/looprestoration16_avx2.asm",
-  "libdav1d/src/x86/looprestoration16_avx512.asm",
-  "libdav1d/src/x86/looprestoration16_sse.asm",
   "libdav1d/src/x86/looprestoration_avx2.asm",
-  "libdav1d/src/x86/looprestoration_avx512.asm",
-  "libdav1d/src/x86/looprestoration_sse.asm",
   "libdav1d/src/x86/mc16_avx2.asm",
-  "libdav1d/src/x86/mc16_avx512.asm",
-  "libdav1d/src/x86/mc16_sse.asm",
   "libdav1d/src/x86/mc_avx2.asm",
+]
+x86_asm_sources_avx512 = [
+  "libdav1d/src/x86/cdef16_avx512.asm",
+  "libdav1d/src/x86/cdef_avx512.asm",
+  "libdav1d/src/x86/filmgrain16_avx512.asm",
+  "libdav1d/src/x86/filmgrain_avx512.asm",
+  "libdav1d/src/x86/ipred16_avx512.asm",
+  "libdav1d/src/x86/ipred_avx512.asm",
+  "libdav1d/src/x86/itx16_avx512.asm",
+  "libdav1d/src/x86/itx_avx512.asm",
+  "libdav1d/src/x86/loopfilter16_avx512.asm",
+  "libdav1d/src/x86/loopfilter_avx512.asm",
+  "libdav1d/src/x86/looprestoration16_avx512.asm",
+  "libdav1d/src/x86/looprestoration_avx512.asm",
+  "libdav1d/src/x86/mc16_avx512.asm",
   "libdav1d/src/x86/mc_avx512.asm",
-  "libdav1d/src/x86/mc_sse.asm",
+]
+x86_asm_sources_common = [
+  "libdav1d/src/x86/cpuid.asm",
   "libdav1d/src/x86/msac.asm",
   "libdav1d/src/x86/pal.asm",
   "libdav1d/src/x86/refmvs.asm",
