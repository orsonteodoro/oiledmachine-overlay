--- a/third_party/dav1d/BUILD.gn.orig	2025-05-06 18:17:34.493556477 -0700
+++ b/third_party/dav1d/BUILD.gn	2025-05-07 10:15:27.977030369 -0700
@@ -147,7 +147,16 @@ if (is_clang && (current_cpu == "arm" ||
 
 if (enable_nasm) {
   nasm_assemble("dav1d_asm") {
-    sources = x86_asm_sources
+    sources = x86_asm_sources_common
+    if (use_sse) {
+      sources += x86_asm_sources_sse
+    }
+    if (use_avx2) {
+      sources += x86_asm_sources_avx2
+    }
+    if (use_avx512) {
+      sources += x86_asm_sources_avx512
+    }
 
     inputs = [
       "$platform_config_root/config.asm",
@@ -316,7 +325,9 @@ static_library("dav1d") {
   if (current_cpu == "x86" || current_cpu == "x64") {
     deps += [ ":dav1d_x86" ]
     if (enable_nasm) {
-      deps += [ ":dav1d_asm" ]
+      if (use_sse || use_avx2 || use_avx512) {
+        deps += [ ":dav1d_asm" ]
+      }
     }
   } else if (current_cpu == "arm" || current_cpu == "arm64") {
     deps += [ ":dav1d_arm" ]
--- a/third_party/dav1d/dav1d_generated.gni.orig	2025-04-27 16:35:54.000000000 -0700
+++ b/third_party/dav1d/dav1d_generated.gni	2025-05-07 10:14:19.617148934 -0700
@@ -4,50 +4,56 @@
 
 # NOTE: this file is autogenerated by dav1d/generate_sources.py - DO NOT EDIT.
 
-x86_asm_sources = [
-  "libdav1d/src/x86/cdef16_avx2.asm",
-  "libdav1d/src/x86/cdef16_avx512.asm",
+x86_asm_sources_sse = [
   "libdav1d/src/x86/cdef16_sse.asm",
-  "libdav1d/src/x86/cdef_avx2.asm",
-  "libdav1d/src/x86/cdef_avx512.asm",
   "libdav1d/src/x86/cdef_sse.asm",
-  "libdav1d/src/x86/cpuid.asm",
-  "libdav1d/src/x86/filmgrain16_avx2.asm",
-  "libdav1d/src/x86/filmgrain16_avx512.asm",
   "libdav1d/src/x86/filmgrain16_sse.asm",
-  "libdav1d/src/x86/filmgrain_avx2.asm",
-  "libdav1d/src/x86/filmgrain_avx512.asm",
   "libdav1d/src/x86/filmgrain_sse.asm",
-  "libdav1d/src/x86/ipred16_avx2.asm",
-  "libdav1d/src/x86/ipred16_avx512.asm",
   "libdav1d/src/x86/ipred16_sse.asm",
-  "libdav1d/src/x86/ipred_avx2.asm",
-  "libdav1d/src/x86/ipred_avx512.asm",
   "libdav1d/src/x86/ipred_sse.asm",
-  "libdav1d/src/x86/itx16_avx2.asm",
-  "libdav1d/src/x86/itx16_avx512.asm",
   "libdav1d/src/x86/itx16_sse.asm",
-  "libdav1d/src/x86/itx_avx2.asm",
-  "libdav1d/src/x86/itx_avx512.asm",
   "libdav1d/src/x86/itx_sse.asm",
-  "libdav1d/src/x86/loopfilter16_avx2.asm",
-  "libdav1d/src/x86/loopfilter16_avx512.asm",
   "libdav1d/src/x86/loopfilter16_sse.asm",
-  "libdav1d/src/x86/loopfilter_avx2.asm",
-  "libdav1d/src/x86/loopfilter_avx512.asm",
+  "libdav1d/src/x86/looprestoration16_sse.asm",
   "libdav1d/src/x86/loopfilter_sse.asm",
+  "libdav1d/src/x86/looprestoration_sse.asm",
+  "libdav1d/src/x86/mc16_sse.asm",
+  "libdav1d/src/x86/mc_sse.asm",
+]
+x86_asm_sources_avx2 = [
+  "libdav1d/src/x86/cdef16_avx2.asm",
+  "libdav1d/src/x86/cdef_avx2.asm",
+  "libdav1d/src/x86/filmgrain16_avx2.asm",
+  "libdav1d/src/x86/filmgrain_avx2.asm",
+  "libdav1d/src/x86/ipred16_avx2.asm",
+  "libdav1d/src/x86/ipred_avx2.asm",
+  "libdav1d/src/x86/itx16_avx2.asm",
+  "libdav1d/src/x86/itx_avx2.asm",
+  "libdav1d/src/x86/loopfilter16_avx2.asm",
+  "libdav1d/src/x86/loopfilter_avx2.asm",
   "libdav1d/src/x86/looprestoration16_avx2.asm",
-  "libdav1d/src/x86/looprestoration16_avx512.asm",
-  "libdav1d/src/x86/looprestoration16_sse.asm",
   "libdav1d/src/x86/looprestoration_avx2.asm",
-  "libdav1d/src/x86/looprestoration_avx512.asm",
-  "libdav1d/src/x86/looprestoration_sse.asm",
   "libdav1d/src/x86/mc16_avx2.asm",
-  "libdav1d/src/x86/mc16_avx512.asm",
-  "libdav1d/src/x86/mc16_sse.asm",
   "libdav1d/src/x86/mc_avx2.asm",
+]
+x86_asm_sources_avx512 = [
+  "libdav1d/src/x86/cdef16_avx512.asm",
+  "libdav1d/src/x86/cdef_avx512.asm",
+  "libdav1d/src/x86/filmgrain16_avx512.asm",
+  "libdav1d/src/x86/filmgrain_avx512.asm",
+  "libdav1d/src/x86/ipred16_avx512.asm",
+  "libdav1d/src/x86/ipred_avx512.asm",
+  "libdav1d/src/x86/itx16_avx512.asm",
+  "libdav1d/src/x86/itx_avx512.asm",
+  "libdav1d/src/x86/loopfilter16_avx512.asm",
+  "libdav1d/src/x86/loopfilter_avx512.asm",
+  "libdav1d/src/x86/looprestoration16_avx512.asm",
+  "libdav1d/src/x86/looprestoration_avx512.asm",
+  "libdav1d/src/x86/mc16_avx512.asm",
   "libdav1d/src/x86/mc_avx512.asm",
-  "libdav1d/src/x86/mc_sse.asm",
+]
+x86_asm_sources_common = [
+  "libdav1d/src/x86/cpuid.asm",
   "libdav1d/src/x86/msac.asm",
   "libdav1d/src/x86/pal.asm",
   "libdav1d/src/x86/refmvs.asm",
