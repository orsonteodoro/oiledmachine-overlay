<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
  <maintainer type="person">
    <!-- Ebuild fork on the oiledmachine overlay -->
    <email>orsonteodoro@hotmail.com</email>
    <name>Orson Teodoro</name>
  </maintainer>
  <maintainer type="person">
    <!-- Ebuild originator -->
    <email>expeditioneer@gentoo.org</email>
    <name>Dennis Lamm</name>
  </maintainer>
  <longdescription lang="en">
    Firejail is a SUID program that reduces the risk of security breaches by
    restricting the running environment of untrusted applications using Linux
    namespaces and seccomp-bpf. It allows a process and all its descendants to 
    have their own private view of the globally shared kernel resources, such as
    the network stack, process table,
    mount table.

    This is the regular version. For a long term support version see
    sys-apps/firejail-lts.
  </longdescription>
  <!--

    oiledmachine-overlay additions:

      -Improved xpra support
      -Enable or disable sound forwarding
      -/usr/local/bin wrapper auto generation

    Ebuild fork goals:

      -Minimize install bloat
      -Make it easier to use program sandboxed.

    Wrapper versus symlink

    Firejail can use symlink from /usr/bin/firefail to
    /usr/local/bin/PROFILE_NAME, but it runs /usr/bin/PROGRAM_NAME with
    PROFILE_NAME only if PROGRAM_NAME is the same as PROFILE_NAME.  Some
    programs, however, cannot be paired correctly because the profile name is
    unconventional or the capitalization issue.

    This is why a shell wrapper script is used instead.  The shell wrapper will
    tell firejail to run CORRECT_PROGRAM_NAME with PROFILE_NAME.  These
    compatiblity wrappers will be autogenerated by the ebuild.  So correctness
    increases but the startup latency will decrease a little because of the
    shell script startup cost.


    Build time environment variables

    XEPHYR_WH["chromium"]="1920x1080" - Set the default window size for chromium.
    The default is 800x600 for xephyr.
    SCUDO_FREE_IMMEDIATE["keepassx"]=1 - Free the keys in the heap immediately.

    Examples:

    Contents of /etc/portage/env/firejail.conf:
    SCUDO_FREE_IMMEDIATE["keepassx"]=1
    XEPHYR_WH["chromium"]="1920x1080"
    XEPHYR_WH["firefox"]="1920x1080"
    X_BACKEND["chromium"]="xephyr"
    X_BACKEND["firefox"]="xpra"
    X_BACKEND["xchat"]="auto"
    MALLOC_BACKEND["keepassxc"]="mimalloc"
    MALLOC_BACKEND["chromium"]="scudo"
    PATH_CORRECTION["spotify"]="/opt/spotify/spotify-client/spotify"

    Contents of /etc/portage/package.env:
    sys-apps/firejail firejail.conf


    Analysis and explanations:

    By default in this ebuild, scudo will free memory blocks with a delay.  This
    delay is to mitigate against use-after-free.  This delay is dangerous for
    cold boot attacks or maybe Spectre based ones since freeing blocks is not
    eager but event based on size.

    This is why we choose the mimalloc which does eager free.  The keychain has
    to be purged ASAP after the program has been killed without a chance of
    calling its graceful cleaner routine.

    By default, paths are assumed to be /usr/bin/PROGRAM_NAME.  You may want
    to fix the profile name paring with PATH_CORRECTION for binary packages.

  -->
  <upstream>
    <remote-id type="cpe">cpe:/a:firejail_project:firejail</remote-id>
    <remote-id type="github">netblue30/firejail</remote-id>
  </upstream>
  <use>
    <flag name="apparmor">
      Enable support for custom AppArmor profiles
    </flag>
    <flag name="chroot">
      Enable chrooting to custom directory
    </flag>
    <flag name="contrib">
      Install contrib scripts
    </flag>
    <flag name="dbusproxy">
      Enable D-Bus proxy support
    </flag>
    <flag name="file-transfer">
      Enable file transfers between sandboxes and the host system
    </flag>
    <flag name="globalcfg">
      Enable global config file
    </flag>
    <flag name="landlock">
      Enable support for the kernel's Landlock Linux Security Module (LSM).
    </flag>
    <flag name="mimalloc">
      Enable support for mimalloc as a hardened allocator.
    </flag>
    <flag name="network">
      Enable networking features
    </flag>
    <flag name="overlayfs">
      Enable overlayfs
    </flag>
    <flag name="private-home">
      Enable private home feature
    </flag>
    <flag name="scudo">
      Enable support for Scudo as a hardened allocator.
    </flag>
    <flag name="seccomp">
      Enable system call filtering
    </flag>
    <flag name="selinux">
      Enable SELinux labeling support
    </flag>
    <flag name="test">
      Performs basic testing
    </flag>
    <flag name="test-profiles">
      Performs testing on the FireJail profiles.  Expect longer testing time.
    </flag>
    <flag name="test-x11">
      Performs testing on the x11 portions
    </flag>
    <flag name="userns">
      Enable attaching a new user namespace to a sandbox (--noroot option)
    </flag>
    <flag name="x11">
      Enable X11 sandboxing for GUIs in restricted untrusted mode.
      (It may crash programs or programs may not prefer untrusted mode.)
    </flag>
    <flag name="xpra">
      Enable xpra support for windowed apps and better OpenGL support.
    </flag>
    <flag name="xvfb">
      Enable xvfb support for sandboxing remote access or headless servers.
    </flag>
    <flag name="xephyr">
      Enable xephyr support for windowed apps.
    </flag>
    <flag name="wrapper">
      Add USE enabled wrappers to /etc/local/bin to immediately use the program
      sandboxed. (EXPERIMENTAL)
    </flag>
  </use>
</pkgmetadata>
