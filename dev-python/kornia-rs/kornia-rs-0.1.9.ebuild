# Copyright 2024-2025 Orson Teodoro <orsonteodoro@hotmail.com>
# Copyright 1999-2025 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=8

#GENERATE_LOCKFILE=${GENERATE_LOCKFILE:-1}

#DISTUTILS_ARGS=(
#	"kornia-py/Cargo.toml"
#)
DISTUTILS_SINGLE_IMPL=1
DISTUTILS_USE_PEP517="maturin"
PYTHON_COMPAT=( "python3_"{10..12} "pypy3" )
RUST_MAX_VER="1.87.0" # Inclusive
RUST_MIN_VER="1.87.0" # llvm-19.1, fast_image_resize@5.2.1 requires rustc 1.87.0
RUST_PV="${RUST_MIN_VER}"

if ! [[ "${PV}" =~ "9999" ]] ; then
# Example crates:
# These are found in the examples folder or crates folder
CRATES_EXCLUDE="
binarize-0.1.9
colmap_rerun-0.1.9
color_detector-0.1.9
copper-0.1.9
dora-image-utils-0.1.0
dora-imgproc-0.1.0
dora-video-capture-0.1.0
dora-video-sink-0.1.0
fast_detector-0.1.0
features-0.1.0
hello_world-0.1.9
histogram-0.1.9
icp_registration-0.1.9
imgproc-0.1.9
metrics-0.1.9
normalize-0.1.9
normalize_ii-0.1.9
onnx-0.1.9
ply_rerun-0.1.9
rerun_viz-0.1.9
rotate-0.1.9
std_mean-0.1.9
undistort-0.1.9
rtspcam-0.1.0
video_write-0.1.0
video_write_tasks-0.1.0
webcam-0.1.0
kornia-image-0.1.6+dev
kornia-imgproc-0.1.6+dev
kornia-io-0.1.6+dev
kornia-py-0.1.9
kornia-rs-0.1.6+dev
kornia-serve-0.1.6+dev
"

# From "./convert-cargo-lock.sh 0.1.9 0.1.9"
CRATES="
ab_glyph-0.2.31
ab_glyph_rasterizer-0.1.10
accesskit-0.17.1
accesskit_atspi_common-0.10.1
accesskit_consumer-0.26.0
accesskit_macos-0.18.1
accesskit_unix-0.13.1
accesskit_windows-0.24.1
accesskit_winit-0.23.1
addr2line-0.24.2
adler2-2.0.1
adler2-2.0.1
ahash-0.8.12
aho-corasick-1.1.3
aligned-vec-0.5.0
aligned-vec-0.6.4
aligned-vec-0.6.4
allocator-api2-0.2.21
android-activity-0.6.0
android-properties-0.2.2
android_system_properties-0.1.5
android-tzdata-0.1.1
anes-0.1.6
anstream-0.6.20
anstyle-1.0.11
anstyle-parse-0.2.7
anstyle-query-1.1.4
anstyle-wincon-3.0.10
anyhow-1.0.99
anyhow-1.0.99
approx-0.5.1
arbitrary-1.4.1
arbitrary-1.4.1
arboard-3.6.0
arg_enum_proc_macro-0.3.4
arg_enum_proc_macro-0.3.4
argh-0.1.13
argh_derive-0.1.13
argh_shared-0.1.13
array-init-2.1.0
array-init-2.1.0
arrayref-0.3.9
arrayvec-0.7.6
arrayvec-0.7.6
arrow-54.3.1
arrow-arith-54.3.1
arrow-array-54.3.1
arrow-buffer-54.3.1
arrow-cast-54.3.1
arrow-csv-54.3.1
arrow-data-54.3.1
arrow-ipc-54.3.1
arrow-json-54.3.1
arrow-ord-54.3.1
arrow-row-54.3.1
arrow-schema-54.3.1
arrow-select-54.3.1
arrow-string-54.3.1
ascii-1.1.0
ash-0.38.0+1.3.281
ashpd-0.11.0
as-raw-xcb-connection-1.0.1
assert_matches-1.5.0
async-broadcast-0.7.2
async-channel-2.5.0
async-executor-1.13.2
async-fs-2.1.3
async-io-2.5.0
async-lock-3.4.1
async-net-2.0.0
async-process-2.4.0
async-recursion-1.1.1
async-signal-0.2.12
async-stream-0.3.6
async-stream-impl-0.3.6
async-task-4.7.1
async-trait-0.1.88
atoi-2.0.0
atomic_refcell-0.1.13
atomic-waker-1.1.2
atomig-0.4.3
atomig-macro-0.4.0
atspi-0.22.0
atspi-common-0.6.0
atspi-connection-0.6.0
atspi-proxies-0.6.0
autocfg-1.5.0
autocfg-1.5.0
av1-grain-0.2.4
av1-grain-0.2.4
av-data-0.4.4
avif-serialize-0.8.5
avif-serialize-0.8.5
axum-0.7.9
axum-core-0.4.5
az-1.2.1
az-1.2.1
backtrace-0.3.75
base64-0.13.1
base64-0.21.7
base64-0.22.1
binarize-0.1.9
bincode-1.3.3
bincode-1.3.3
bincode-2.0.1
bincode_derive-2.0.1
bit_field-0.10.2
bit_field-0.10.2
bitflags-1.3.2
bitflags-1.3.2
bitflags-2.9.1
bitflags-2.9.1
bit-set-0.8.0
bitstream-io-2.6.0
bitstream-io-2.6.0
bit-vec-0.8.0
block-0.1.6
block2-0.5.1
block2-0.6.1
block-buffer-0.10.4
block-buffer-0.10.4
blocking-1.6.2
bstr-1.12.0
built-0.7.7
built-0.7.7
bumpalo-3.19.0
bumpalo-3.19.0
bytecount-0.6.9
bytemuck-1.23.2
bytemuck-1.23.2
bytemuck_derive-1.10.1
bytemuck_derive-1.10.1
byteorder-1.5.0
byteorder-1.5.0
byteorder-lite-0.1.0
byteorder-lite-0.1.0
bytes-1.10.1
byte-slice-cast-1.2.3
cacache-13.1.0
calloop-0.13.0
calloop-wayland-source-0.3.0
camino-1.1.11
cargo_metadata-0.14.2
cargo_metadata-0.18.1
cargo-platform-0.1.9
cast-0.3.0
castaway-0.2.4
cc-1.2.32
cc-1.2.32
cesu8-1.1.0
cfb-0.7.3
cfg_aliases-0.2.1
cfg-expr-0.15.8
cfg-expr-0.15.8
cfg-expr-0.20.2
cfg-if-1.0.1
cfg-if-1.0.1
cgl-0.3.2
chrono-0.4.41
chunked_transfer-1.5.0
ciborium-0.2.2
ciborium-io-0.2.2
ciborium-ll-0.2.2
circular-buffer-1.1.0
circular-buffer-1.1.0
clang-format-0.3.0
clap-4.5.45
clap_builder-4.5.44
clap_derive-4.5.45
clap_lex-0.7.5
clean-path-0.2.1
clipboard-win-5.4.1
cmake-0.1.54
cmake-0.1.54
cmov-0.3.1
cmov-0.3.1
codespan-reporting-0.11.1
coe-rs-0.1.2
coe-rs-0.1.2
colmap_rerun-0.1.9
colorchoice-1.0.4
color_detector-0.1.9
colored-2.2.0
color-hex-0.2.0
color_quant-1.1.0
color_quant-1.1.0
combine-4.6.7
comfy-table-7.1.4
compact_str-0.9.0
concat-idents-1.1.5
concurrent-queue-2.5.0
console-0.15.11
const_format-0.2.34
const_format_proc_macros-0.2.34
constgebra-0.1.4
const-random-0.1.18
const-random-macro-0.1.16
const_soft_float-0.1.4
convert_case-0.6.0
convert_case-0.8.0
copper-0.1.9
cordyceps-0.3.4
core-foundation-0.10.1
core-foundation-0.9.4
core-foundation-sys-0.8.7
core-graphics-0.23.2
core-graphics-types-0.1.3
cpufeatures-0.2.17
cpufeatures-0.2.17
crc32fast-1.5.0
crc32fast-1.5.0
criterion-0.5.1
criterion-plot-0.5.0
crossbeam-0.8.4
crossbeam-channel-0.5.15
crossbeam-deque-0.8.6
crossbeam-deque-0.8.6
crossbeam-epoch-0.9.18
crossbeam-epoch-0.9.18
crossbeam-queue-0.3.12
crossbeam-utils-0.8.21
crossbeam-utils-0.8.21
crossterm-0.28.1
crossterm_winapi-0.9.1
crunchy-0.2.4
crunchy-0.2.4
crypto-common-0.1.6
crypto-common-0.1.6
csv-1.3.1
csv-core-0.1.12
ctrlc-3.4.7
cu29-0.7.0
cu29-clock-0.7.0
cu29-derive-0.7.0
cu29-helpers-0.7.0
cu29-intern-strs-0.7.0
cu29-log-0.7.0
cu29-log-derive-0.7.0
cu29-log-runtime-0.7.0
cu29-runtime-0.7.0
cu29-traits-0.7.0
cu29-unifiedlog-0.7.0
cu29-value-0.7.0
cursor-icon-1.2.0
darling-0.20.11
darling_core-0.20.11
darling_macro-0.20.11
dashmap-5.5.3
data-url-0.3.1
dbgf-0.1.2
dbgf-0.1.2
deranged-0.4.0
diatomic-waker-0.2.3
digest-0.10.7
digest-0.10.7
directories-5.0.1
dirs-4.0.0
dirs-sys-0.3.7
dirs-sys-0.4.1
dispatch-0.2.0
dispatch2-0.3.0
displaydoc-0.2.5
divrem-1.0.0
divrem-1.0.0
dlib-0.5.2
doc-comment-0.3.3
doc-comment-0.3.3
document-features-0.2.11
document-features-0.2.11
dora-arrow-convert-0.3.12
dora-core-0.3.12
dora-image-utils-0.1.0
dora-imgproc-0.1.0
dora-message-0.5.0
dora-metrics-0.3.12
dora-node-api-0.3.12
dora-tracing-0.3.12
dora-video-capture-0.1.0
dora-video-sink-0.1.0
downcast-rs-1.2.1
dpi-0.1.2
dunce-1.0.5
dyn-clone-1.0.20
dyn-stack-0.11.0
dyn-stack-0.11.0
dyn-stack-0.13.0
dyn-stack-0.13.0
ecolor-0.31.1
econtext-0.2.0
eframe-0.31.1
egui-0.31.1
egui_animation-0.8.0
egui_commonmark-0.20.0
egui_commonmark_backend-0.20.0
egui_dnd-0.12.0
egui_extras-0.31.1
egui_glow-0.31.1
egui_plot-0.32.1
egui_table-0.3.0
egui_tiles-0.12.0
egui-wgpu-0.31.1
egui-winit-0.31.1
ehttp-0.5.0
either-1.15.0
either-1.15.0
emath-0.31.1
encode_unicode-1.0.0
endi-1.1.0
enum-as-inner-0.6.1
enum-as-inner-0.6.1
enumflags2-0.7.12
enumflags2_derive-0.7.12
enum-map-2.7.3
enum-map-derive-0.17.0
enumn-0.1.14
enumset-1.1.7
enumset_derive-0.12.0
env_filter-0.1.3
env_logger-0.11.8
epaint-0.31.1
epaint_default_fonts-0.31.1
equator-0.2.2
equator-0.2.2
equator-0.4.2
equator-0.4.2
equator-macro-0.2.1
equator-macro-0.2.1
equator-macro-0.4.2
equator-macro-0.4.2
equivalent-1.0.2
equivalent-1.0.2
errno-0.3.13
error-chain-0.12.4
error-code-3.3.2
event-listener-5.4.1
event-listener-strategy-0.5.4
exr-1.73.0
exr-1.73.0
eyre-0.6.12
faer-0.20.2
faer-0.20.2
faer-entity-0.20.1
faer-entity-0.20.1
fast_detector-0.1.0
fast_image_resize-5.2.1
fast_image_resize-5.2.1
fastrand-2.3.0
fdeflate-0.3.7
fdeflate-0.3.7
features-0.1.0
ffmpeg-sidecar-2.1.0
filetime-0.2.25
filters-0.1.0
fixed-1.29.0
fixed-1.29.0
fixedbitset-0.5.7
fjadra-0.2.1
flatbuffers-24.12.23
flate2-1.1.2
flate2-1.1.2
float-cmp-0.9.0
flume-0.10.14
fnv-1.0.7
foldhash-0.1.5
foreign-types-0.5.0
foreign-types-macros-0.2.3
foreign-types-shared-0.3.1
form_urlencoded-1.2.1
fsevent-sys-4.1.0
fs_extra-1.3.0
futures-0.3.31
futures-buffered-0.2.12
futures-channel-0.3.31
futures-concurrency-7.6.3
futures-core-0.3.31
futures-executor-0.3.31
futures-io-0.3.31
futures-lite-2.6.1
futures-macro-0.3.31
futures-sink-0.3.31
futures-task-0.3.31
futures-timer-3.0.3
futures-util-0.3.31
gcd-2.3.0
gcd-2.3.0
gemm-0.18.2
gemm-0.18.2
gemm-c32-0.18.2
gemm-c32-0.18.2
gemm-c64-0.18.2
gemm-c64-0.18.2
gemm-common-0.18.2
gemm-common-0.18.2
gemm-f16-0.18.2
gemm-f16-0.18.2
gemm-f32-0.18.2
gemm-f32-0.18.2
gemm-f64-0.18.2
gemm-f64-0.18.2
generativity-1.1.0
generativity-1.1.0
generator-0.8.5
generator-0.8.5
generic-array-0.14.7
generic-array-0.14.7
geo-types-0.7.17
gethostname-0.4.3
getrandom-0.2.16
getrandom-0.2.16
getrandom-0.3.3
getrandom-0.3.3
gif-0.13.3
gif-0.13.3
gimli-0.31.1
gio-sys-0.20.10
glam-0.28.0
glam-0.30.5
gl_generator-0.14.0
glib-0.20.12
glib-macros-0.20.12
glib-sys-0.20.10
glob-0.3.3
glow-0.16.0
gltf-1.4.1
gltf-derive-1.4.1
gltf-json-1.4.1
glutin-0.32.3
glutin_egl_sys-0.7.1
glutin_glx_sys-0.6.1
glutin_wgl_sys-0.6.1
glutin-winit-0.5.0
gobject-sys-0.20.10
gpu-alloc-0.6.0
gpu-alloc-types-0.3.0
gpu-descriptor-0.3.2
gpu-descriptor-types-0.2.0
gstreamer-0.23.7
gstreamer-app-0.23.5
gstreamer-app-sys-0.23.5
gstreamer-base-0.23.6
gstreamer-base-sys-0.23.6
gstreamer-sys-0.23.6
h2-0.4.12
half-2.6.0
half-2.6.0
hashbrown-0.12.3
hashbrown-0.14.5
hashbrown-0.15.5
hashbrown-0.15.5
hdrhistogram-7.5.4
heck-0.5.0
heck-0.5.0
hello_egui_utils-0.8.0
hello_world-0.1.9
hermit-abi-0.5.2
hex-0.4.3
hexasphere-14.1.0
hexf-parse-0.2.1
histogram-0.1.9
home-0.5.9
http-1.3.1
httparse-1.10.1
http-body-1.0.1
http-body-util-0.1.3
http-cache-0.20.1
http-cache-reqwest-0.15.1
http-cache-semantics-2.1.0
httpdate-1.0.3
http-serde-2.1.1
humantime-2.2.0
hyper-1.6.0
hyper-rustls-0.27.7
hyper-timeout-0.5.2
hyper-util-0.1.16
iana-time-zone-0.1.63
iana-time-zone-haiku-0.1.2
icp_registration-0.1.9
icu_collections-2.0.0
icu_locale_core-2.0.0
icu_normalizer-2.0.0
icu_normalizer_data-2.0.0
icu_properties-2.0.1
icu_properties_data-2.0.1
icu_provider-2.0.0
id-arena-2.2.1
ident_case-1.0.1
idna-1.0.3
idna_adapter-1.2.1
image-0.25.6
image-0.25.6
imageproc-0.25.0
imagesize-0.12.0
image-webp-0.2.3
image-webp-0.2.3
imgproc-0.1.9
imgref-1.11.0
imgref-1.11.0
immutable-chunkmap-2.0.6
indent-0.1.1
indenter-0.3.4
indexmap-1.9.3
indexmap-2.10.0
indexmap-2.10.0
indicatif-0.17.11
indoc-2.0.6
infer-0.16.0
inflections-1.1.1
inotify-0.9.6
inotify-sys-0.1.5
integer-encoding-3.0.4
interpolate_name-0.2.4
interpolate_name-0.2.4
io-uring-0.7.9
ipnet-2.11.0
iri-string-0.7.8
is-terminal-0.4.16
is_terminal_polyfill-1.70.1
itertools-0.10.5
itertools-0.12.1
itertools-0.12.1
itertools-0.13.0
itertools-0.14.0
itoa-1.0.15
jiff-0.2.15
jiff-static-0.2.15
jiff-tzdb-0.1.4
jiff-tzdb-platform-0.1.3
jni-0.21.1
jni-sys-0.3.0
jobserver-0.1.33
jobserver-0.1.33
jpeg-decoder-0.3.2
jpeg-decoder-0.3.2
jpeg-encoder-0.6.1
jpeg-encoder-0.6.1
js-sys-0.3.77
khronos_api-3.1.0
khronos-egl-6.0.0
kiddo-5.2.2
kiddo-5.2.2
kornia-0.1.9
kornia-0.1.9
kornia-3d-0.1.9
kornia-3d-0.1.9
kornia-3d-0.1.9
kornia-icp-0.1.9
kornia-icp-0.1.9
kornia-icp-0.1.9
kornia-image-0.1.9
kornia-image-0.1.9
kornia-image-0.1.9
kornia-imgproc-0.1.9
kornia-imgproc-0.1.9
kornia-imgproc-0.1.9
kornia-io-0.1.9
kornia-io-0.1.9
kornia-io-0.1.9
kornia-linalg-0.1.9
kornia-linalg-0.1.9
kornia-py-0.1.9
kornia-tensor-0.1.9
kornia-tensor-0.1.9
kornia-tensor-0.1.9
kornia-tensor-ops-0.1.9
kornia-tensor-ops-0.1.9
kqueue-1.1.1
kqueue-sys-1.0.4
kurbo-0.9.5
lazy_static-1.5.0
lazy_static-1.5.0
lebe-0.5.2
lebe-0.5.2
lexical-core-1.0.5
lexical-parse-float-1.0.5
lexical-parse-integer-1.0.5
lexical-util-1.0.6
lexical-write-float-1.0.5
lexical-write-integer-1.0.5
libc-0.2.175
libc-0.2.175
libfuzzer-sys-0.4.10
libfuzzer-sys-0.4.10
libloading-0.8.8
libm-0.2.15
libm-0.2.15
libredox-0.1.9
linked-hash-map-0.5.6
linux-raw-sys-0.4.15
linux-raw-sys-0.9.4
litemap-0.8.0
litrs-0.4.2
litrs-0.4.2
lmdb-rkv-0.14.0
lmdb-rkv-sys-0.11.2
lock_api-0.4.13
log-0.4.27
log-0.4.27
log-once-0.4.1
loom-0.7.2
loop9-0.1.5
loop9-0.1.5
lru-0.13.0
lru-slab-0.1.2
lz4_flex-0.11.5
malloc_buf-0.0.6
matchers-0.1.0
matchit-0.7.3
matrixcompare-0.3.0
matrixcompare-0.3.0
matrixcompare-core-0.1.0
matrixcompare-core-0.1.0
matrixmultiply-0.3.10
matrixmultiply-0.3.10
maybe-rayon-0.1.1
maybe-rayon-0.1.1
memchr-2.7.5
memchr-2.7.5
memmap2-0.5.10
memmap2-0.9.7
memoffset-0.6.5
memoffset-0.9.1
memoffset-0.9.1
memory-stats-1.2.0
metal-0.31.0
metrics-0.1.9
miette-5.10.0
miette-derive-5.10.0
mime-0.3.17
mime_guess2-2.3.1
minimal-lexical-0.2.1
minimal-lexical-0.2.1
miniz_oxide-0.8.9
miniz_oxide-0.8.9
mio-0.8.11
mio-1.0.4
muldiv-1.0.1
naga-24.0.0
nalgebra-0.32.6
nano-gemm-0.1.3
nano-gemm-0.1.3
nano-gemm-c32-0.1.0
nano-gemm-c32-0.1.0
nano-gemm-c64-0.1.0
nano-gemm-c64-0.1.0
nano-gemm-codegen-0.1.0
nano-gemm-codegen-0.1.0
nano-gemm-core-0.1.0
nano-gemm-core-0.1.0
nano-gemm-f32-0.1.0
nano-gemm-f32-0.1.0
nano-gemm-f64-0.1.0
nano-gemm-f64-0.1.0
nanorand-0.7.0
nasm-rs-0.3.0
natord-1.0.9
ndarray-0.15.6
ndarray-0.16.1
ndarray-0.16.1
ndk-0.9.0
ndk-context-0.1.1
ndk-sys-0.5.0+25.2.9519653
ndk-sys-0.6.0+11769913
never-0.1.0
new_debug_unreachable-1.0.6
new_debug_unreachable-1.0.6
nix-0.23.2
nix-0.26.4
nix-0.29.0
nix-0.30.1
nohash-hasher-0.2.0
nom-7.1.3
nom-7.1.3
noop_proc_macro-0.3.0
noop_proc_macro-0.3.0
normalize-0.1.9
normalize_ii-0.1.9
notify-6.1.1
npyz-0.8.4
npyz-0.8.4
ntapi-0.4.1
nu-ansi-term-0.46.0
nu-ansi-term-0.46.0
num-0.4.3
number_prefix-0.4.0
num-bigint-0.4.6
num-bigint-0.4.6
num-complex-0.4.6
num-complex-0.4.6
num-conv-0.1.0
num_cpus-1.17.0
num-derive-0.4.2
num-derive-0.4.2
num_enum-0.7.4
num_enum_derive-0.7.4
num-integer-0.1.46
num-integer-0.1.46
num-iter-0.1.45
numpy-0.24.0
num-rational-0.4.2
num-rational-0.4.2
num_threads-0.1.7
num-traits-0.2.19
num-traits-0.2.19
objc-0.2.7
objc2-0.5.2
objc2-0.6.2
objc2-app-kit-0.2.2
objc2-app-kit-0.3.1
objc2-cloud-kit-0.2.2
objc2-contacts-0.2.2
objc2-core-data-0.2.2
objc2-core-foundation-0.3.1
objc2-core-graphics-0.3.1
objc2-core-image-0.2.2
objc2-core-location-0.2.2
objc2-encode-4.1.0
objc2-foundation-0.2.2
objc2-foundation-0.3.1
objc2-io-surface-0.3.1
objc2-link-presentation-0.2.2
objc2-metal-0.2.2
objc2-quartz-core-0.2.2
objc2-symbols-0.2.2
objc2-ui-kit-0.2.2
objc2-uniform-type-identifiers-0.2.2
objc2-user-notifications-0.2.2
objc-sys-0.3.5
object-0.36.7
object-pool-0.6.0
once_cell-1.21.3
once_cell-1.21.3
once_cell_polyfill-1.70.1
onig-6.5.1
onig_sys-69.9.1
onnx-0.1.9
oorandom-11.1.5
openssl-probe-0.1.6
opentelemetry-0.18.0
opentelemetry-0.29.1
opentelemetry_api-0.18.0
opentelemetry-http-0.29.0
opentelemetry-jaeger-0.17.0
opentelemetry-otlp-0.29.0
opentelemetry-proto-0.29.0
opentelemetry_sdk-0.18.0
opentelemetry_sdk-0.29.0
opentelemetry-semantic-conventions-0.10.0
opentelemetry-system-metrics-0.4.2
option-ext-0.2.0
option-operations-0.5.0
orbclient-0.3.48
ordered-float-1.1.1
ordered-float-2.10.1
ordered-float-3.9.2
ordered-float-4.6.0
ordered-float-5.0.0
ordered-float-5.0.0
ordered-stream-0.2.0
ort-2.0.0-rc.9
ort-sys-2.0.0-rc.9
overload-0.1.1
overload-0.1.1
owned_ttf_parser-0.25.1
page_size-0.6.0
parking-2.2.1
parking_lot-0.12.4
parking_lot_core-0.9.11
parquet-54.3.1
paste-1.0.15
paste-1.0.15
pathdiff-0.2.3
peg-0.6.3
peg-macros-0.6.3
peg-runtime-0.6.3
percent-encoding-2.3.1
pest-2.8.1
pest-2.8.1
pest_derive-2.8.1
pest_derive-2.8.1
pest_generator-2.8.1
pest_generator-2.8.1
pest_meta-2.8.1
pest_meta-2.8.1
petgraph-0.7.1
phf-0.11.3
phf_generator-0.11.3
phf_macros-0.11.3
phf_shared-0.11.3
pico-args-0.5.0
pin-project-1.1.10
pin-project-internal-1.1.10
pin-project-lite-0.2.16
pin-project-lite-0.2.16
pin-utils-0.1.0
piper-0.2.4
pkg-config-0.3.32
pkg-config-0.3.32
plist-1.7.4
plotters-0.3.7
plotters-backend-0.3.7
plotters-svg-0.3.7
ply_rerun-0.1.9
ply-rs-0.1.3
png-0.17.16
png-0.17.16
polling-3.10.0
poll-promise-0.3.0
pollster-0.4.0
portable-atomic-1.11.1
portable-atomic-1.11.1
portable-atomic-util-0.2.4
portable-atomic-util-0.2.4
potential_utf-0.1.2
powerfmt-0.2.0
ppv-lite86-0.2.21
ppv-lite86-0.2.21
prettyplease-0.2.36
proc-macro2-1.0.97
proc-macro2-1.0.97
proc-macro-crate-3.3.0
profiling-1.0.17
profiling-1.0.17
profiling-procmacros-1.0.17
profiling-procmacros-1.0.17
prost-0.13.5
prost-derive-0.13.5
prost-types-0.13.5
puffin-0.19.1
puffin_http-0.16.1
pulldown-cmark-0.12.2
pulldown-cmark-0.9.6
pulp-0.18.22
pulp-0.18.22
pulp-0.21.5
pulp-0.21.5
py_literal-0.4.0
py_literal-0.4.0
pyo3-0.24.2
pyo3-build-config-0.24.2
pyo3-ffi-0.24.2
pyo3-macros-0.24.2
pyo3-macros-backend-0.24.2
qoi-0.4.1
qoi-0.4.1
quanta-0.12.6
quick-error-2.0.1
quick-error-2.0.1
quick-xml-0.30.0
quick-xml-0.37.5
quick-xml-0.38.1
quinn-0.11.8
quinn-proto-0.11.12
quinn-udp-0.5.13
quote-1.0.40
quote-1.0.40
rand-0.8.5
rand-0.8.5
rand-0.9.2
rand_chacha-0.3.1
rand_chacha-0.3.1
rand_chacha-0.9.0
rand_core-0.6.4
rand_core-0.6.4
rand_core-0.9.3
rand_distr-0.4.3
rand_distr-0.4.3
rav1e-0.7.1
rav1e-0.7.1
ravif-0.11.20
ravif-0.11.20
raw-cpuid-11.5.0
raw-cpuid-11.5.0
rawpointer-0.2.1
rawpointer-0.2.1
raw_sync_2-0.1.5
raw-window-handle-0.6.2
rayon-1.11.0
rayon-1.11.0
rayon-core-1.13.0
rayon-core-1.13.0
rctree-0.5.0
re_analytics-0.23.4
re_arrow_util-0.23.4
re_blueprint_tree-0.23.4
reborrow-0.5.5
reborrow-0.5.5
re_build_info-0.23.4
re_build_tools-0.23.4
re_byte_size-0.23.4
re_capabilities-0.23.4
re_case-0.23.4
re_chunk-0.23.4
re_chunk_store-0.23.4
re_chunk_store_ui-0.23.4
re_component_ui-0.23.4
re_context_menu-0.23.4
re_crash_handler-0.23.4
re_dataframe-0.23.4
re_dataframe_ui-0.23.4
re_data_loader-0.23.4
re_data_source-0.23.4
re_data_ui-0.23.4
redox_syscall-0.4.1
redox_syscall-0.5.17
redox_users-0.4.6
re_entity_db-0.23.4
re_error-0.23.4
r-efi-5.3.0
r-efi-5.3.0
reflink-copy-0.1.26
re_format-0.23.4
re_format_arrow-0.23.4
regex-1.11.1
regex-automata-0.1.10
regex-automata-0.4.9
regex-syntax-0.6.29
regex-syntax-0.8.5
re_grpc_client-0.23.4
re_grpc_server-0.23.4
re_int_histogram-0.23.4
re_log-0.23.4
re_log_encoding-0.23.4
re_log_types-0.23.4
re_math-0.20.0
re_memory-0.23.4
re_mp4-0.3.0
renderdoc-sys-1.1.0
re_protos-0.23.4
re_query-0.23.4
reqwest-0.12.23
reqwest-middleware-0.4.2
re_rav1d-0.1.3
re_redap_browser-0.23.4
re_renderer-0.23.4
rerun-0.23.4
rerun_viz-0.1.9
re_sdk-0.23.4
re_selection_panel-0.23.4
re_smart_channel-0.23.4
re_sorbet-0.23.4
re_string_interner-0.23.4
resvg-0.37.0
re_time_panel-0.23.4
re_tracing-0.23.4
re_tuid-0.23.4
re_types-0.23.4
re_types_builder-0.23.4
re_types_core-0.23.4
re_ui-0.23.4
re_uri-0.23.4
re_video-0.23.4
re_view-0.23.4
re_view_bar_chart-0.23.4
re_view_dataframe-0.23.4
re_viewer-0.23.4
re_viewer_context-0.23.4
re_view_graph-0.23.4
re_view_map-0.23.4
re_viewport-0.23.4
re_viewport_blueprint-0.23.4
re_view_spatial-0.23.4
re_view_tensor-0.23.4
re_view_text_document-0.23.4
re_view_text_log-0.23.4
re_view_time_series-0.23.4
re_web_viewer_server-0.23.4
rexif-0.7.5
rfd-0.15.4
rgb-0.8.52
rgb-0.8.52
ring-0.17.14
rkv-0.19.0
rmp-0.8.14
rmp-serde-1.3.0
ron-0.8.1
rotate-0.1.9
roxmltree-0.19.0
rtspcam-0.1.0
rustc-demangle-0.1.26
rustc-hash-1.1.0
rustc-hash-2.1.1
rustc-hash-2.1.1
rustc_version-0.4.1
rust-format-0.3.4
rust-fuzzy-search-0.1.1
rustix-0.38.44
rustix-1.0.8
rustls-0.23.31
rustls-native-certs-0.8.1
rustls-pemfile-2.2.0
rustls-pki-types-1.12.0
rustls-webpki-0.103.4
rustversion-1.0.22
rustversion-1.0.22
ryu-1.0.20
safe_arch-0.7.4
same-file-1.0.6
same-file-1.0.6
schannel-0.1.27
schemars-0.8.22
schemars_derive-0.8.22
scoped-tls-1.0.1
scopeguard-1.2.0
sctk-adwaita-0.10.1
security-framework-3.3.0
security-framework-sys-2.14.0
semver-1.0.26
seq-macro-0.3.6
seq-macro-0.3.6
serde-1.0.219
serde-1.0.219
serde_bytes-0.11.17
serde_derive-1.0.219
serde_derive-1.0.219
serde_derive_internals-0.29.1
serde_json-1.0.142
serde_repr-0.1.20
serde_spanned-0.6.9
serde_spanned-0.6.9
serde_urlencoded-0.7.1
serde-wasm-bindgen-0.6.5
serde-with-expand-env-1.1.0
serde_yaml-0.9.34+deprecated
sha-1-0.10.1
sha1-0.10.6
sha2-0.10.9
sha2-0.10.9
sharded-slab-0.1.7
sharded-slab-0.1.7
shared_memory_extended-0.13.0
shared-memory-server-0.3.12
shellexpand-2.1.2
shlex-1.3.0
shlex-1.3.0
signal-hook-registry-1.4.6
simba-0.8.1
simd-adler32-0.3.7
simd-adler32-0.3.7
simd_helpers-0.1.0
simd_helpers-0.1.0
simdutf8-0.1.5
similar-2.7.0
similar-asserts-1.7.0
simplecss-0.2.2
simple-easing-1.0.1
simplelog-0.12.2
siphasher-0.3.11
siphasher-1.0.1
skeptic-0.13.7
slab-0.4.11
slotmap-1.0.7
smallvec-1.15.1
smallvec-1.15.1
smithay-client-toolkit-0.19.2
smithay-clipboard-0.7.2
smol_str-0.2.2
snap-1.1.1
socket2-0.5.10
socket2-0.6.0
sorted-vec-0.8.7
sorted-vec-0.8.7
spin-0.10.0
spin-0.9.8
spirv-0.3.0+sdk-1.3.268.0
ssri-9.2.0
stable_deref_trait-1.2.0
static_assertions-1.1.0
std_mean-0.1.9
strfmt-0.2.5
strict-num-0.1.1
strsim-0.11.1
strum-0.26.3
strum_macros-0.26.4
sublime_fuzzy-0.7.0
subtle-2.6.1
svgtypes-0.13.0
syn-2.0.105
syn-2.0.105
sync_wrapper-1.0.2
synstructure-0.13.2
syntect-5.2.0
sysctl-0.6.0
sysctl-0.6.0
sysinfo-0.30.13
sysinfo-0.34.2
system-deps-6.2.2
system-deps-6.2.2
system-deps-7.0.5
tap-1.0.1
target-lexicon-0.12.16
target-lexicon-0.12.16
target-lexicon-0.13.2
target-lexicon-0.13.2
tempfile-3.20.0
termcolor-1.4.1
thiserror-1.0.69
thiserror-1.0.69
thiserror-2.0.14
thiserror-2.0.14
thiserror-impl-1.0.69
thiserror-impl-1.0.69
thiserror-impl-2.0.14
thiserror-impl-2.0.14
thread_local-1.1.9
thread_local-1.1.9
threadpool-1.8.1
thrift-0.16.0
thrift-0.17.0
tiff-0.9.1
tiff-0.9.1
time-0.3.41
time-core-0.1.4
time-macros-0.2.22
tiny_http-0.12.0
tiny-keccak-2.0.2
tiny-skia-0.11.4
tiny-skia-path-0.11.4
tinystl-0.0.3
tinystr-0.8.1
tinytemplate-1.2.1
tinyvec-1.9.0
tinyvec_macros-0.1.1
tobj-4.0.3
tokio-1.47.1
tokio-macros-2.5.0
tokio-rustls-0.26.2
tokio-stream-0.1.17
tokio-util-0.7.16
to_method-1.1.0
toml-0.8.23
toml-0.8.23
toml_datetime-0.6.11
toml_datetime-0.6.11
toml_edit-0.22.27
toml_edit-0.22.27
tonic-0.12.3
tonic-web-0.12.3
tonic-web-wasm-client-0.6.2
tower-0.4.13
tower-0.5.2
tower-http-0.5.2
tower-http-0.6.6
tower-layer-0.3.3
tower-service-0.3.3
tracing-0.1.41
tracing-0.1.41
tracing-attributes-0.1.30
tracing-attributes-0.1.30
tracing-core-0.1.34
tracing-core-0.1.34
tracing-log-0.1.4
tracing-log-0.2.0
tracing-log-0.2.0
tracing-opentelemetry-0.18.0
tracing-subscriber-0.3.19
tracing-subscriber-0.3.19
try-lock-0.2.5
ttf-parser-0.25.1
turbojpeg-1.3.3
turbojpeg-1.3.3
turbojpeg-sys-1.1.1
turbojpeg-sys-1.1.1
twox-hash-1.6.3
twox-hash-2.1.1
type-map-0.5.1
typenum-1.18.0
typenum-1.18.0
ucd-trie-0.1.7
ucd-trie-0.1.7
uds_windows-1.1.0
uhlc-0.5.2
undistort-0.1.9
unicase-2.8.1
unicode-ident-1.0.18
unicode-ident-1.0.18
unicode-segmentation-1.12.0
unicode-width-0.1.14
unicode-width-0.2.1
unicode-xid-0.2.6
unindent-0.2.4
unindent-0.2.4
unsafe-libyaml-0.2.11
untrusted-0.9.0
unty-0.0.4
ureq-2.12.1
url-2.5.4
urlencoding-2.1.3
usvg-0.37.0
usvg-parser-0.37.0
usvg-tree-0.37.0
utf8_iter-1.0.4
utf8parse-0.2.2
uuid-1.18.0
valuable-0.1.1
valuable-0.1.1
vec1-1.12.1
version_check-0.9.5
version_check-0.9.5
version-compare-0.2.0
version-compare-0.2.0
v_frame-0.3.9
v_frame-0.3.9
video_write-0.1.0
video_write_tasks-0.1.0
virtue-0.0.18
walkdir-2.5.0
walkdir-2.5.0
walkers-0.36.0
want-0.3.1
wasi-0.11.1+wasi-snapshot-preview1
wasi-0.11.1+wasi-snapshot-preview1
wasi-0.14.2+wasi-0.2.4
wasi-0.14.2+wasi-0.2.4
wasm-bindgen-0.2.100
wasm-bindgen-0.2.100
wasm-bindgen-backend-0.2.100
wasm-bindgen-backend-0.2.100
wasm-bindgen-futures-0.4.50
wasm-bindgen-macro-0.2.100
wasm-bindgen-macro-0.2.100
wasm-bindgen-macro-support-0.2.100
wasm-bindgen-macro-support-0.2.100
wasm-bindgen-shared-0.2.100
wasm-bindgen-shared-0.2.100
wasm-streams-0.4.2
wayland-backend-0.3.11
wayland-client-0.31.11
wayland-csd-frame-0.3.0
wayland-cursor-0.31.11
wayland-protocols-0.32.9
wayland-protocols-plasma-0.3.9
wayland-protocols-wlr-0.3.9
wayland-scanner-0.31.7
wayland-sys-0.31.7
webbrowser-1.0.5
webcam-0.1.0
webpki-roots-0.26.11
webpki-roots-1.0.2
web-sys-0.3.77
web-time-1.1.0
weezl-0.1.10
weezl-0.1.10
wgpu-24.0.5
wgpu-core-24.0.5
wgpu-hal-24.0.4
wgpu-types-24.0.0
which-5.0.0
wide-0.7.33
winapi-0.3.9
winapi-0.3.9
winapi-i686-pc-windows-gnu-0.4.0
winapi-i686-pc-windows-gnu-0.4.0
winapi-util-0.1.9
winapi-util-0.1.9
winapi-x86_64-pc-windows-gnu-0.4.0
winapi-x86_64-pc-windows-gnu-0.4.0
windows-0.34.0
windows-0.52.0
windows-0.57.0
windows-0.58.0
windows-0.61.3
windows-0.61.3
windows_aarch64_gnullvm-0.42.2
windows_aarch64_gnullvm-0.48.5
windows_aarch64_gnullvm-0.52.6
windows_aarch64_gnullvm-0.52.6
windows_aarch64_gnullvm-0.53.0
windows_aarch64_msvc-0.34.0
windows_aarch64_msvc-0.42.2
windows_aarch64_msvc-0.48.5
windows_aarch64_msvc-0.52.6
windows_aarch64_msvc-0.52.6
windows_aarch64_msvc-0.53.0
windows-collections-0.2.0
windows-collections-0.2.0
windows-core-0.52.0
windows-core-0.57.0
windows-core-0.58.0
windows-core-0.61.2
windows-core-0.61.2
windows-future-0.2.1
windows-future-0.2.1
windows_i686_gnu-0.34.0
windows_i686_gnu-0.42.2
windows_i686_gnu-0.48.5
windows_i686_gnu-0.52.6
windows_i686_gnu-0.52.6
windows_i686_gnu-0.53.0
windows_i686_gnullvm-0.52.6
windows_i686_gnullvm-0.52.6
windows_i686_gnullvm-0.53.0
windows_i686_msvc-0.34.0
windows_i686_msvc-0.42.2
windows_i686_msvc-0.48.5
windows_i686_msvc-0.52.6
windows_i686_msvc-0.52.6
windows_i686_msvc-0.53.0
windows-implement-0.57.0
windows-implement-0.58.0
windows-implement-0.60.0
windows-implement-0.60.0
windows-interface-0.57.0
windows-interface-0.58.0
windows-interface-0.59.1
windows-interface-0.59.1
windows-link-0.1.3
windows-link-0.1.3
windows-numerics-0.2.0
windows-numerics-0.2.0
windows-result-0.1.2
windows-result-0.2.0
windows-result-0.3.4
windows-result-0.3.4
windows-strings-0.1.0
windows-strings-0.4.2
windows-strings-0.4.2
windows-sys-0.45.0
windows-sys-0.48.0
windows-sys-0.52.0
windows-sys-0.59.0
windows-sys-0.59.0
windows-sys-0.60.2
windows-targets-0.42.2
windows-targets-0.48.5
windows-targets-0.52.6
windows-targets-0.52.6
windows-targets-0.53.3
windows-threading-0.1.0
windows-threading-0.1.0
windows_x86_64_gnu-0.34.0
windows_x86_64_gnu-0.42.2
windows_x86_64_gnu-0.48.5
windows_x86_64_gnu-0.52.6
windows_x86_64_gnu-0.52.6
windows_x86_64_gnu-0.53.0
windows_x86_64_gnullvm-0.42.2
windows_x86_64_gnullvm-0.48.5
windows_x86_64_gnullvm-0.52.6
windows_x86_64_gnullvm-0.52.6
windows_x86_64_gnullvm-0.53.0
windows_x86_64_msvc-0.34.0
windows_x86_64_msvc-0.42.2
windows_x86_64_msvc-0.48.5
windows_x86_64_msvc-0.52.6
windows_x86_64_msvc-0.52.6
windows_x86_64_msvc-0.53.0
winit-0.30.12
winnow-0.7.12
winnow-0.7.12
win-sys-0.3.1
wit-bindgen-rt-0.39.0
wit-bindgen-rt-0.39.0
writeable-0.6.1
x11-dl-2.21.0
x11rb-0.13.1
x11rb-protocol-0.13.1
xcursor-0.3.10
xdg-home-1.3.0
xkbcommon-dl-0.4.2
xkeysym-0.2.1
xml-rs-0.8.27
xmlwriter-0.1.0
xshell-0.2.7
xshell-macros-0.2.7
xxhash-rust-0.8.15
yaml-rust-0.4.5
yoke-0.8.0
yoke-derive-0.8.0
zbus-4.4.0
zbus-5.9.0
zbus-lockstep-0.4.4
zbus-lockstep-macros-0.4.4
zbus_macros-4.4.0
zbus_macros-5.9.0
zbus_names-3.0.0
zbus_names-4.2.0
zbus_xml-4.0.0
zerocopy-0.7.35
zerocopy-0.8.26
zerocopy-0.8.26
zerocopy-derive-0.7.35
zerocopy-derive-0.8.26
zerocopy-derive-0.8.26
zerofrom-0.1.6
zerofrom-derive-0.1.6
zeroize-1.8.1
zerotrie-0.2.2
zerovec-0.11.4
zerovec-derive-0.11.1
zune-core-0.4.12
zune-core-0.4.12
zune-inflate-0.2.54
zune-inflate-0.2.54
zune-jpeg-0.4.20
zune-jpeg-0.4.20
zvariant-4.2.0
zvariant-5.6.0
zvariant_derive-4.2.0
zvariant_derive-5.6.0
zvariant_utils-2.1.0
zvariant_utils-3.2.0
"
	is_crate_excluded() {
		local pkg="${1}"
		local x
		for x in ${CRATES_EXCLUDE[@]} ; do
			if [[ "${x}" == "${pkg}" ]] ; then
				return 0
			fi
		done
		return 1
	}

	exclude_crates() {
		local x
		for x in ${CRATES[@]} ; do
			if is_crate_excluded "${x}" ; then
				:
			else
				echo " ${x}"
			fi
		done
	}
	CRATES=$(exclude_crates)

	inherit cargo distutils-r1
else
	inherit distutils-r1
fi

inherit pypi

if [[ "${PV}" =~ "9999" ]] ; then
	EGIT_BRANCH="main"
	EGIT_CHECKOUT_DIR="${WORKDIR}/${P}"
	EGIT_REPO_URI="https://github.com/kornia/kornia-rs.git"
	FALLBACK_COMMIT="a934f413e487d6cf86dd24598a3d6f2dc3c246d5" # Jan 25, 2024
	IUSE+=" fallback-commit"
	S="${WORKDIR}/${P}"
	inherit git-r3
else

	KEYWORDS="~amd64"
	S="${WORKDIR}/${PN}-${PV}"
	SRC_URI="
$(cargo_crate_uris ${CRATES})
https://github.com/kornia/kornia-rs/archive/refs/tags/v${PV}.tar.gz
	-> ${P}.tar.gz
	"
fi

DESCRIPTION="A low-level 3D computer vision library in Rust"
HOMEPAGE="
	https://docs.rs/kornia
	https://github.com/kornia/kornia-rs
	https://pypi.org/project/kornia-rs
"
LICENSE="
	Apache-2.0
"
RESTRICT="mirror test" # Untested
SLOT="0/$(ver_cut 1-2 ${PV})"
IUSE+="
dev test
ebuild_revision_2
"
REQUIRED_USE="
	dev? (
		test
	)
"
RDEPEND+="
"
DEPEND+="
	${RDEPEND}
"
BDEPEND+="
	$(python_gen_cond_dep '
		>=dev-util/maturin-1[${PYTHON_USEDEP}]
		dev-python/pytest[${PYTHON_USEDEP}]
		dev? (
			>=dev-python/numpy-1.23.0[${PYTHON_USEDEP}]
			dev-python/pytest[${PYTHON_USEDEP}]
		)
	')
	|| (
		dev-lang/rust:${RUST_PV}
		dev-lang/rust-bin:${RUST_PV}
	)
	|| (
		dev-lang/rust:=
		dev-lang/rust-bin:=
	)
	dev? (
		>=dev-python/kornia-0.7.2[${PYTHON_SINGLE_USEDEP}]
		dev-python/jax[${PYTHON_SINGLE_USEDEP},cpu]
	)
"
DOCS=( "README.md" )
PATCHES=(
)

_lockfile_gen_unpack() {
	unpack "${P}.tar.gz"
	cd "${S}" || die
einfo "Generating lockfile"
	rm Cargo.lock
	cargo generate-lockfile || die "Failed to update Cargo.lock"

einfo "Fixing vulnerabilities"
#	cargo install "glib@0.20.0"						# GHSA-wrw7-89jp-8q8g; ZC, DT; Moderate

	die
}

_production_unpack() {
	unpack "${P}.tar.gz"
	#die # For manual lockfile updates

	cp -aT \
		"${FILESDIR}/${PV}"* \
		"${S}" \
		|| die
}

pkg_setup() {
	python-single-r1_pkg_setup
	rust_pkg_setup
}

src_unpack() {
	if [[ "${PV}" =~ "9999" ]] ; then
		use fallback-commit && EGIT_COMMIT="${FALLBACK_COMMIT}"
		git-r3_fetch
		git-r3_checkout
	else
		if [[ "${GENERATE_LOCKFILE}" == "1" ]] ; then
			_lockfile_gen_unpack
		else
			_production_unpack
		fi
#		export S="${WORKDIR}/${PN}-${PV}"
		cargo_src_unpack
	fi
}

src_prepare() {
	distutils-r1_src_prepare
}

src_configure() {
	distutils-r1_src_configure
}


python_compile() {
#	edo python3 -m venv .venv
#	edo maturin develop -m kornia-py/Cargo.toml
#	emake build-python-release
#	export S="${WORKDIR}/${PN}-${PV}"

	# Fix path
	cp -aT "${S}/examples/video_write tasks" "${S}/examples/video_write_tasks" || die
	rm -rf "${S}/examples/video_write tasks"

	cargo_src_compile
	pushd "kornia-py" >/dev/null 2>&1 || die
		S="${WORKDIR}/${PN}-${PV}" \
		distutils-r1_python_compile
	popd >/dev/null 2>&1 || die
}

src_compile() {
	distutils-r1_src_compile
}

src_install() {
	distutils-r1_src_install
	docinto "licenses"
	dodoc "LICENSE"
}

# OILEDMACHINE-OVERLAY-META:  CREATED-EBUILD
