diff '--color=auto' -urp pam-python-1.0.8.orig/src/pam_python.c pam-python-1.0.8/src/pam_python.c
--- pam-python-1.0.8.orig/src/pam_python.c	2026-02-02 03:13:38.572372173 -0800
+++ pam-python-1.0.8/src/pam_python.c	2026-02-02 07:01:20.805432091 -0800
@@ -121,10 +121,12 @@ static char libpython_so[]	= LIBPYTHON_S
 static void initialise_python(void)
 {
 #if	PY_MAJOR_VERSION*100 + PY_MINOR_VERSION >= 204
+#  if PY_VERSION_HEX < 0x030C0000   /* before 3.12 */
   Py_DontWriteBytecodeFlag = 1;
   Py_IgnoreEnvironmentFlag = 1;	/* Required to mitigate CVE-2019-16729 */
   Py_NoUserSiteDirectory = 1;	/* Required to mitigate CVE-2019-16729 */
-#if PY_VERSION_HEX >= 0x03000000
+#  endif
+#if PY_VERSION_HEX >= 0x03000000 && PY_VERSION_HEX < 0x030C0000
   Py_IsolatedFlag = 1;
 #endif
   /* Py_NoSiteFlag = 1; 	Breaks too many things */
