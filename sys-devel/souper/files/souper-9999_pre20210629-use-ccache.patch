Subject:  Strip abspath to use ccache path first with distro multislot support.
Patch author:   Orson Teodoro <orsonteodoro@hotmail.com>
Date:  Sun Feb 13 12:22:55 AM PST 2022 (Unix time:  1644740575)
Patch status:  Testing

License header for patched files:

// Copyright 2014 The Souper Authors. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

diff -urp souper-69536e134478ae1d44c912c90c3db96ad06437c1.orig/utils/sclang.in souper-69536e134478ae1d44c912c90c3db96ad06437c1/utils/sclang.in
--- souper-69536e134478ae1d44c912c90c3db96ad06437c1.orig/utils/sclang.in	2022-02-13 00:14:25.175071490 -0800
+++ souper-69536e134478ae1d44c912c90c3db96ad06437c1/utils/sclang.in	2022-02-13 00:18:57.328980266 -0800
@@ -49,9 +49,9 @@ sub linkp() {
 }
 
-if ($0 =~ /clang$/) {
+if ($0 =~ /clang-@LLVM_VERSION_MAJOR_FOUND@$/ || $0 =~ /clang$/) {					# oteodoro:  changed line.  accept clang or clang-N
-    unshift @ARGV, "@LLVM_BINDIR@/clang";
+    unshift @ARGV, "clang-@LLVM_VERSION_MAJOR_FOUND@";							# oteodoro:  changed line for distro to use ccache
-} elsif ($0 =~ /clang\+\+$/) {
+} elsif ($0 =~ /clang\+\+-@LLVM_VERSION_MAJOR_FOUND@$/ || $0 =~ /clang\+\+$/) {			# oteodoro:  changed line.  accept clang++ or clang++-N
-    unshift @ARGV, "@LLVM_BINDIR@/clang++";
+    unshift @ARGV, "clang++-@LLVM_VERSION_MAJOR_FOUND@";						# oteodoro:  changed line for distro to use ccache
 } else {
     die "Didn't expect sclang to be invoked as '$0'";
 }
