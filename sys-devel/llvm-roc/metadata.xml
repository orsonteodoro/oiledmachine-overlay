<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pkgmetadata SYSTEM "https://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
  <maintainer type="person">
    <!-- Ebuild on the oiledmachine-overlay -->
    <email>orsonteodoro@hotmail.com</email>
    <name>Orson Teodoro</name>
  </maintainer>
  <upstream>
    <remote-id type="github">RadeonOpenCompute/llvm-project</remote-id>
  </upstream>
  <!--

  oiledmachine-overlay notes:

  To get PGO working, add the following files and change the settings to your needs:

  Add to /etc/portage/env/llvm-roc.conf:
ROCM_OVERLAY_DIR="/var/db/repos/oiledmachine-overlay" # Location if using eselect repository
#ROCM_OVERLAY_DIR="/usr/local/oiledmachine-overlay" # An alternative location if using the old README.md instructions.
ROCPRIM_TRAINING_USE="rocm amdgpu_targets_gfx803 amdgpu_targets_gfx900 amdgpu_targets_gfx900_xnack_minus"
ROCRAND_TRAINING_USE="rocm amdgpu_targets_gfx803 amdgpu_targets_gfx900 amdgpu_targets_gfx900_xnack_minus"
ROCSPARSE_TRAINING_USE="amdgpu_targets_gfx803 amdgpu_targets_gfx900 amdgpu_targets_gfx900_xnack_minus"

  Add to /etc/portage/package.env:
sys-devel/llvm-roc llvm-roc.conf

  In the shell, run the following:

  ROCM_SLOT="5.7"
  emerge -1vuDN rocPRIM:${ROCM_SLOT} rocRAND:${ROCM_SLOT} rocSPARSE:${ROCM_SLOT}
  USE="pgo" emerge llvm-roc:${ROCM_SLOT}


  Additional environment variables:

  COMPOSABLE_KERNEL_TRAINING_USE - USE flags used to build the composable_kernel package.
  LLVM_ROC_TRAINERS - A space separated list of ebuilds to train.  Acceptable values composable_kernel, rocBLAS, rocPRIM, rocRAND, rocSPARSE.
  PGO_TOOLCHAIN - Select the PGO toolchain.  Acceptable values - gcc (the default), clang.
  RESTART_PGO - 1 to disable the cached PGO profile or start the PGO process from the beginning.
  ROCBLAS_TRAINING_USE - USE flags used to build the rocBLAS package.
  ROCPRIM_TRAINING_USE - USE flags used to build the rocPRIM package.
  ROCRAND_TRAINING_USE - USE flags used to build the rocRAND package.
  ROCSPARSE_TRAINING_USE - USE flags used to build the rocSPARSE package.

  * To use PGO_TOOLCHAIN="clang", the sys-devel/llvm-roc:${ROCM_SLOT} must be already installed.
  * LLVM_ROC_TRAINERS always needs the associated *_TRAINING_USE environment variable.


  Examples:

  LLVM_ROC_TRAINERS="rocBLAS rocPRIM rocRAND"

  -->
  <use>
    <flag name="pgo">
      Build an optimized Clang toolchain using Profile Guided Optimization (PGO)
      to decrease build times by maybe 20%.
    </flag>
  </use>
</pkgmetadata>
