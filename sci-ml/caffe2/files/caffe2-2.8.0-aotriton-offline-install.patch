--- a/cmake/External/aotriton.cmake	2025-08-04 09:51:07.000000000 -0700
+++ b/cmake/External/aotriton.cmake	2025-11-16 13:00:30.652659792 -0800
@@ -29,6 +29,7 @@ if(NOT __AOTRITON_INCLUDED)
   set(__AOTRITON_Z "gz")
 
   # Note it is INSTALL"ED"
+  option(AOTRITON_OFFLINE_INSTALL "Build aotriton from a downloaded offline tarball" ON)
   if(DEFINED ENV{AOTRITON_INSTALLED_PREFIX})
     install(DIRECTORY
             $ENV{AOTRITON_INSTALLED_PREFIX}/lib
@@ -36,6 +37,77 @@ if(NOT __AOTRITON_INCLUDED)
             DESTINATION ${__AOTRITON_INSTALL_DIR})
     set(__AOTRITON_INSTALL_DIR "$ENV{AOTRITON_INSTALLED_PREFIX}")
     message(STATUS "Using Preinstalled AOTriton at ${__AOTRITON_INSTALL_DIR}")
+  elseif(AOTRITON_OFFLINE_INSTALL)
+    # ------------------------------------------------------------------
+    # 1. Download the exact the tarball
+    # ------------------------------------------------------------------
+    set(AOTRITON_TARBALL_URL
+        "https://github.com/ROCm/aotriton/archive/@AOTRITION_COMMIT@.tar.gz")
+    set(AOTRITON_TARBALL_HASH
+        "SHA256=@AIOTRON_TARBALL_SHA256_FINGERPRINT@")
+
+    set(AOTRITON_TARBALL
+        "${CMAKE_BINARY_DIR}/aotriton-@AOTRITION_SHORT_COMMIT@.tar.gz")
+
+    file(DOWNLOAD
+         "${AOTRITON_TARBALL_URL}"
+         "${AOTRITON_TARBALL}"
+         STATUS _dl_status
+         EXPECTED_HASH ${AOTRITON_TARBALL_HASH}
+         SHOW_PROGRESS)
+
+    list(GET _dl_status 0 _dl_code)
+    if(NOT _dl_code EQUAL 0)
+      message(FATAL_ERROR "Failed to download AOTriton tarball")
+    endif()
+
+    # ------------------------------------------------------------------
+    # 2. Extract into a *source* directory that ExternalProject can use
+    # ------------------------------------------------------------------
+    set(AOTRITON_EXTRACT_DIR
+        "${CMAKE_BINARY_DIR}/aotriton-src")
+
+    file(MAKE_DIRECTORY "${AOTRITON_EXTRACT_DIR}")
+
+    execute_process(
+      COMMAND ${CMAKE_COMMAND} -E tar xzf "${AOTRITON_TARBALL}"
+      WORKING_DIRECTORY "${AOTRITON_EXTRACT_DIR}"
+      RESULT_VARIABLE _untar_res)
+    if(NOT _untar_res EQUAL 0)
+      message(FATAL_ERROR "Failed to unpack AOTriton tarball")
+    endif()
+
+    # The tarball extracts to a folder named aotriton-<commit>
+    file(GLOB AOTRITON_EXTRACTED_DIR
+         "${AOTRITON_EXTRACT_DIR}/aotriton-*")
+    list(LENGTH AOTRITON_EXTRACTED_DIR _cnt)
+    if(NOT _cnt EQUAL 1)
+      message(FATAL_ERROR "Unexpected tarball layout")
+    endif()
+
+    # ------------------------------------------------------------------
+    # 3. Build from the extracted source
+    # ------------------------------------------------------------------
+    ExternalProject_Add(aotriton_external
+      SOURCE_DIR ${AOTRITON_EXTRACTED_DIR}
+      BINARY_DIR ${__AOTRITON_BUILD_DIR}
+      PREFIX     ${__AOTRITON_INSTALL_DIR}
+      CMAKE_ARGS
+        -DCMAKE_INSTALL_PREFIX:PATH=${__AOTRITON_INSTALL_DIR}
+        -DAOTRITON_COMPRESS_KERNEL=OFF
+        -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
+        -DAOTRITON_NO_PYTHON=ON
+        -DAOTRITON_NO_SHARED=ON
+      BUILD_COMMAND ""   # work-around double build
+      BUILD_BYPRODUCTS "${__AOTRITON_INSTALL_DIR}/lib/libaotriton_v2.a"
+      USES_TERMINAL_DOWNLOAD   TRUE
+      USES_TERMINAL_CONFIGURE TRUE
+      USES_TERMINAL_BUILD     TRUE
+      USES_TERMINAL_INSTALL   TRUE
+    )
+
+    add_dependencies(__caffe2_aotriton aotriton_external)
+    message(STATUS "AOTriton will be built from offline tarball")
   elseif(DEFINED ENV{AOTRITON_INSTALL_FROM_SOURCE})
     ExternalProject_Add(aotriton_external
       GIT_REPOSITORY https://github.com/ROCm/aotriton.git
