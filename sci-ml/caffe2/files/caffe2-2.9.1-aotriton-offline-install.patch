--- pytorch-2.9.1.orig/cmake/External/aotriton.cmake	2025-11-10 17:02:50.000000000 -0800
+++ pytorch-2.9.1/cmake/External/aotriton.cmake	2025-12-07 21:11:25.322592225 -0800
@@ -127,7 +127,23 @@ if(NOT __AOTRITON_INCLUDED)
   endfunction()
 
   # Note it is INSTALL"ED"
-  if(DEFINED ENV{AOTRITON_INSTALLED_PREFIX})
+  set(AOTRITON_OFFLINE_INSTALL ON CACHE BOOL "Force offline AOTriton build" FORCE)
+  if(AOTRITON_OFFLINE_INSTALL)
+    message(STATUS "AOTRITON: using pre-unpacked local copy from third_party/aotriton")
+
+    set(AOTRITON_SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/third_party/aotriton")
+
+    # Build directly from local source (no ExternalProject, no venv, no pip)
+    add_subdirectory(${AOTRITON_SOURCE_DIR} aotriton-build EXCLUDE_FROM_ALL)
+
+    # Reuse the existing __caffe2_aotriton interface target (do NOT recreate it)
+    target_link_libraries(__caffe2_aotriton INTERFACE aotriton_v2)
+    target_include_directories(__caffe2_aotriton INTERFACE "${AOTRITON_SOURCE_DIR}/include")
+
+    set(AOTRITON_FOUND TRUE)
+    message(STATUS "AOTRITON: local build complete and linked")
+    return()   # Skip the rest of the original logic
+  elseif(DEFINED ENV{AOTRITON_INSTALLED_PREFIX})
     install(DIRECTORY
             $ENV{AOTRITON_INSTALLED_PREFIX}/lib
             $ENV{AOTRITON_INSTALLED_PREFIX}/include
