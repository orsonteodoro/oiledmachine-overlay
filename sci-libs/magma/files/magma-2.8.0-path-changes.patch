diff -urp magma-2.8.0.orig/CMakeLists.txt magma-2.8.0/CMakeLists.txt
--- magma-2.8.0.orig/CMakeLists.txt	2024-03-28 05:23:41.000000000 -0700
+++ magma-2.8.0/CMakeLists.txt	2024-05-06 15:25:58.783054348 -0700
@@ -323,7 +323,7 @@ endif()
 
 if (MAGMA_ENABLE_HIP)
   set( GPU_TARGET "gfx900" CACHE STRING "HIP architectures to compile for" )
-  list(APPEND CMAKE_PREFIX_PATH /opt/rocm /opt/rocm/lib/cmake/hip)
+  list(APPEND CMAKE_PREFIX_PATH @ESYSROOT_ROCM_PATH@ @ESYSROOT_ROCM_PATH@/@ROCM_LIBDIR@/cmake/hip)
   find_package( HIP )
   if (HIP_FOUND)
     message( STATUS "Found HIP ${HIP_VERSION}" )
@@ -456,7 +456,9 @@ if (LAPACK_LIBRARIES MATCHES mkl_core)
         if (NOT EXISTS ${MKLROOT})
             message( FATAL_ERROR "MKLROOT ${MKLROOT} directory does not exist." )
         endif()
+        message(STATUS "MKLROOT:  ${MKLROOT}" )
         include_directories( ${MKLROOT}/include )
+        link_directories( ${MKLROOT}/@MKL_LIBDIR@/intel64 )
         add_definitions( -DMAGMA_WITH_MKL )
         message( STATUS "Define -DMAGMA_WITH_MKL" )
     endif()
@@ -464,9 +466,9 @@ endif()
 
 
 # ----------------------------------------
-# save magma.lib, magma_sparse.lib, etc. in lib/
-set( CMAKE_ARCHIVE_OUTPUT_DIRECTORY lib )
-set( CMAKE_LIBRARY_OUTPUT_DIRECTORY lib )
+# save magma.lib, magma_sparse.lib, etc. in @COND_LIBDIR@/
+set( CMAKE_ARCHIVE_OUTPUT_DIRECTORY @COND_LIBDIR@ )
+set( CMAKE_LIBRARY_OUTPUT_DIRECTORY @COND_LIBDIR@ )
 
 
 # ----------------------------------------
@@ -716,7 +718,7 @@ add_custom_target( sparse-lib DEPENDS ma
 # compile each tester
 
 # save testers to testing/
-# save tester lib files to testing_lib/ to avoid cluttering lib/
+# save tester lib files to testing_lib/ to avoid cluttering @COND_LIBDIR@/
 set( CMAKE_RUNTIME_OUTPUT_DIRECTORY testing )
 set( CMAKE_ARCHIVE_OUTPUT_DIRECTORY testing_lib )
 set( CMAKE_LIBRARY_OUTPUT_DIRECTORY testing_lib )
@@ -765,8 +767,8 @@ add_custom_target( sparse-testing DEPEND
 # what to install
 install( TARGETS magma magma_sparse ${blas_fix}
          RUNTIME DESTINATION bin
-         LIBRARY DESTINATION lib
-         ARCHIVE DESTINATION lib )
+         LIBRARY DESTINATION @COND_LIBDIR@
+         ARCHIVE DESTINATION @COND_LIBDIR@ )
 if (MAGMA_ENABLE_CUDA)
   file( GLOB headers include/*.h sparse/include/*.h "${CMAKE_BINARY_DIR}/include/*.h" )
 else()
@@ -786,8 +788,10 @@ foreach(dir ${MAGMA_INCLUDE})
     string(APPEND INCLUDE_COMPILER_STRING "-I${dir} ")
 endforeach()
 set( MAGMA_INCLUDE "${INCLUDE_COMPILER_STRING}" )
-set( pkgconfig lib/pkgconfig/magma.pc )
-message( STATUS "pkgconfig ${pkgconfig}" )
+set( pkgconfig_in lib/pkgconfig/magma.pc )
+set( pkgconfig_out @COND_LIBDIR@/pkgconfig/magma.pc )
+message( STATUS "pkgconfig_in ${pkgconfig_in}" )
+message( STATUS "pkgconfig_out ${pkgconfig_out}" )
 set( INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}" )
 set( CFLAGS "${CMAKE_C_FLAGS}" )
 set( CXXFLAGS "${CMAKE_CXX_FLAGS}" )
@@ -802,9 +806,9 @@ else()
 #    "${blas_fix_lib} ${LAPACK_LIBS} hip::device roc::hipblas roc::hipsparse" )
 endif()
 set( MAGMA_REQUIRED "" )
-configure_file( "${pkgconfig}.in" "${pkgconfig}" @ONLY )
-install( FILES "${CMAKE_BINARY_DIR}/${pkgconfig}"
-         DESTINATION lib/pkgconfig )
+configure_file( "${pkgconfig_in}.in" "${pkgconfig_out}" @ONLY )
+install( FILES "${CMAKE_BINARY_DIR}/${pkgconfig_out}"
+         DESTINATION @COND_LIBDIR@/pkgconfig )
 
 # ----------------------------------------
 get_directory_property( compile_definitions COMPILE_DEFINITIONS )
diff -urp magma-2.8.0.orig/docs/documentation.txt magma-2.8.0/docs/documentation.txt
--- magma-2.8.0.orig/docs/documentation.txt	2024-03-28 05:23:39.000000000 -0700
+++ magma-2.8.0/docs/documentation.txt	2024-05-06 15:25:58.783054348 -0700
@@ -78,7 +78,7 @@ For bash (sh), put in `~/.bashrc` (with
 
 For csh/tcsh, put in `~/.cshrc`:
 
-    setenv CUDADIR /usr/local/cuda
+    setenv CUDADIR /opt/cuda
 
 MAGMA is tested with CUDA >= 7.5. Some functionality requires a newer version.
 
@@ -130,11 +130,11 @@ For csh/tcsh, put in ~/.cshrc:
 The OpenBLAS `make.inc` file assumes `$OPENBLASDIR` is set in your environment.
 For bash (sh), put in ~/.bashrc (with your system's path):
 
-    export OPENBLASDIR=/opt/openblas
+    export OPENBLASDIR=/usr
 
 For csh/tcsh, put in ~/.cshrc:
 
-    setenv OPENBLASDIR /opt/openblas
+    setenv OPENBLASDIR /usr
 
 Some bugs exist with OpenBLAS 0.2.19; see BUGS.txt.
 
@@ -146,7 +146,7 @@ and `clange` -- return a double precisio
 with our C/C++ headers and with the Fortran code used in our testers. The fix is
 to substitute reference implementations of these functions, found in
 `magma/blas_fix`. Setting `blas_fix = 1` in `make.inc` will compile these into
-`magma/lib/libblas_fix.a`, with which your application should link.
+`magma/@COND_LIBDIR@/libblas_fix.a`, with which your application should link.
 
 
 Linking to BLAS
@@ -261,13 +261,13 @@ or
 
 will create shared libraries:
 
-    lib/libmagma.so
-    lib/libmagma_sparse.so
+    @COND_LIBDIR@/libmagma.so
+    @COND_LIBDIR@/libmagma_sparse.so
 
 and static libraries:
 
-    lib/libmagma.a
-    lib/libmagma_sparse.a
+    @COND_LIBDIR@/libmagma.a
+    @COND_LIBDIR@/libmagma_sparse.a
 
 and testing drivers in `testing` and `sparse-iter/testing`.
 
@@ -285,8 +285,8 @@ static library. Then, running:
 
 will create static libraries:
 
-    lib/libmagma.a
-    lib/libmagma_sparse.a
+    @COND_LIBDIR@/libmagma.a
+    @COND_LIBDIR@/libmagma_sparse.a
 
 and testing drivers in `testing` and `sparse-iter/testing`.
 
@@ -299,9 +299,9 @@ To install libraries and include files i
 
 The default prefix is `/usr/local/magma`. You can also set `prefix` in `make.inc`.
 This installs
-MAGMA libraries in `${prefix}/lib`,
+MAGMA libraries in `${prefix}/@COND_LIBDIR@`,
 MAGMA header files in `${prefix}/include`, and
-`${prefix}/lib/pkgconfig/magma.pc` for `pkg-config`.
+`${prefix}/@COND_LIBDIR@/pkgconfig/magma.pc` for `pkg-config`.
 
 
 Tuning
diff -urp magma-2.8.0.orig/example/Makefile magma-2.8.0/example/Makefile
--- magma-2.8.0.orig/example/Makefile	2024-03-28 05:23:44.000000000 -0700
+++ magma-2.8.0/example/Makefile	2024-05-06 15:25:58.787054319 -0700
@@ -7,8 +7,8 @@
 # MAGMADIR can be .. to test without installing.
 #MAGMADIR     ?= ..
 MAGMADIR     ?= /usr/local/magma
-CUDADIR      ?= /usr/local/cuda
-OPENBLASDIR  ?= /usr/local/openblas
+CUDADIR      ?= /opt/cuda
+OPENBLASDIR  ?= /usr
 
 CC            = gcc
 FORT          = gfortran
@@ -28,10 +28,10 @@ LDFLAGS       = -Wall #-fopenmp
 # MAGMA_F90FLAGS   := -Dmagma_devptr_t="integer(kind=8)" \
 #                     -I$(MAGMADIR)/include
 # 
-# # may be lib instead of lib64 on some systems
-# MAGMA_LIBS       := -L$(MAGMADIR)/lib -lmagma_sparse -lmagma \
-#                     -L$(CUDADIR)/lib64 -lcublas -lcudart -lcusparse \
-#                     -L$(OPENBLASDIR)/lib -lopenblas
+# # may be lib instead of lib64 on some systems
+# MAGMA_LIBS       := -L$(MAGMADIR)/@COND_LIBDIR@ -lmagma_sparse -lmagma \
+#                     -L$(CUDADIR)/@ABI_LIBDIR@ -lcublas -lcudart -lcusparse \
+#                     -L$(OPENBLASDIR)/@ABI_LIBDIR@ -lopenblas
 
 
 # ----------------------------------------
diff -urp magma-2.8.0.orig/example/README.txt magma-2.8.0/example/README.txt
--- magma-2.8.0.orig/example/README.txt	2024-03-28 05:23:43.000000000 -0700
+++ magma-2.8.0/example/README.txt	2024-05-06 15:25:58.787054319 -0700
@@ -39,7 +39,7 @@ make.inc for how Fortran functions are n
 common is ADD_, where Fortran adds an underscore after the function. Usually,
 you can tell the convention by using nm to examine your BLAS library:
 
-    nm /mnt/scratch/openblas/lib/libopenblas.a | grep -i dnrm2
+    nm /usr/@ABI_LIBDIR@/libopenblas.a | grep -i dnrm2
     dnrm2.o:
     0000000000000000 T dnrm2_
                      U dnrm2_k
@@ -59,9 +59,9 @@ To link, add the library paths and neces
 -lmagma should be before -lcublas and your BLAS/LAPACK libraries.
 For example with OpenBLAS:
 
-    gcc -L$MAGMADIR/lib    -lmagma_sparse -lmagma \
-        -L$CUDADIR/lib64   -lcublas -lcudart -lcusparse \
-        -L$OPENBLASDIR/lib -lopenblas \
+    gcc -L$MAGMADIR/@COND_LIBDIR@    -lmagma_sparse -lmagma \
+        -L$CUDADIR/@ABI_LIBDIR@   -lcublas -lcudart -lcusparse \
+        -L$OPENBLASDIR/@ABI_LIBDIR@ -lopenblas \
         -o example example.o
 
 If you are not using MAGMA sparse routines, you can omit -lmagma_sparse.
@@ -76,11 +76,11 @@ If it cannot find the shared libraries:
 you may need to add these paths to your LD_LIBRARY_PATH. For instance, with
 sh/bash:
 
-    LD_LIBRARY_PATH=$MAGMADIR/lib:$CUDADIR/lib64:$OPENBLASDIR/lib
+    LD_LIBRARY_PATH=$MAGMADIR/@COND_LIBDIR@:$CUDADIR/@ABI_LIBDIR@:$OPENBLASDIR/@ABI_LIBDIR@
 
 or with csh/tcsh:
 
-    setenv LD_LIBRARY_PATH $MAGMADIR/lib:$CUDADIR/lib64:$OPENBLASDIR/lib
+    setenv LD_LIBRARY_PATH $MAGMADIR/@COND_LIBDIR@:$CUDADIR/@ABI_LIBDIR@:$OPENBLASDIR/@ABI_LIBDIR@
 
 ----------------------------------------
 Fortran example
@@ -110,9 +110,9 @@ Here is compiling the example, compiling
              -I$CUDADIR/include \
              -c -o fortran.o $CUDADIR/src/fortran.c
 
-    gfortran -L$MAGMADIR/lib    -lmagma_sparse -lmagma \
-             -L$CUDADIR/lib64   -lcublas -lcudart -lcusparse \
-             -L$OPENBLASDIR/lib -lopenblas \
+    gfortran -L$MAGMADIR/@COND_LIBDIR@    -lmagma_sparse -lmagma \
+             -L$CUDADIR/@ABI_LIBDIR@   -lcublas -lcudart -lcusparse \
+             -L$OPENBLASDIR/@ABI_LIBDIR@ -lopenblas \
              -o example_f example_f.o fortran.o
 
 
@@ -127,7 +127,7 @@ Alternatively, you can use pkg-config to
 automatically. To use pkg-config, install MAGMA with 'make install', add MAGMA
 to $PKG_CONFIG_PATH, e.g. with csh,
 
-    setenv PKG_CONFIG_PATH ${PKG_CONFIG_PATH}:/usr/local/magma/lib/pkgconfig
+    setenv PKG_CONFIG_PATH ${PKG_CONFIG_PATH}:/usr/@COND_LIBDIR@/pkgconfig
 
 then use 'pkg-config --cflags magma' and 'pkg-config --libs magma' as shown in
 the Makefile.
diff -urp magma-2.8.0.orig/fortran/Makefile magma-2.8.0/fortran/Makefile
--- magma-2.8.0.orig/fortran/Makefile	2024-03-28 05:23:40.000000000 -0700
+++ magma-2.8.0/fortran/Makefile	2024-05-06 15:25:58.787054319 -0700
@@ -14,7 +14,7 @@ CFLAGS     = -Wall -I$(MAGMADIR)/include
 CXXFLAGS   = -Wall -I$(MAGMADIR)/include -I$(CUDADIR)/include
 FCFLAGS    = -Wall -Wno-unused-function
 LDFLAGS    =
-LIBS       = -L$(MAGMADIR)/lib -lmagma -Wl,-rpath,$(MAGMADIR)/lib
+LIBS       = -L$(MAGMADIR)/@COND_LIBDIR@ -lmagma -Wl,-rpath,$(MAGMADIR)/@COND_LIBDIR@
 
 # BLAS and LAPACK libraries
 # framework Accelerate is for MacOS
diff -urp magma-2.8.0.orig/include/magma_types.h magma-2.8.0/include/magma_types.h
--- magma-2.8.0.orig/include/magma_types.h	2024-03-28 05:22:52.000000000 -0700
+++ magma-2.8.0/include/magma_types.h	2024-05-06 15:25:58.787054319 -0700
@@ -176,7 +176,7 @@ typedef double real_Double_t;
      *
      * To generate a list of these, first remove all these macro definitions, run a `make clean`
      * to clear caches, and then start running:
-     * $ make lib/libmagma.so -j64 2>&1 \
+     * $ make @COND_LIBDIR@/libmagma.so -j64 2>&1 \
      *     | grep "use of undeclared identifier" \
      *     | awk '{gsub("'"'"'", "", $7) ; gsub(";", "", $7) ; print $7}'
      *
diff -urp magma-2.8.0.orig/lib/pkgconfig/magma.pc.in magma-2.8.0/lib/pkgconfig/magma.pc.in
--- magma-2.8.0.orig/lib/pkgconfig/magma.pc.in	2024-03-28 05:24:10.000000000 -0700
+++ magma-2.8.0/lib/pkgconfig/magma.pc.in	2024-05-06 15:25:58.787054319 -0700
@@ -1,6 +1,6 @@
 prefix=@INSTALL_PREFIX@
 exec_prefix=${prefix}
-libdir=${exec_prefix}/lib
+libdir=${exec_prefix}/@COND_LIBDIR@
 includedir=${prefix}/include
 
 Name: magma
diff -urp magma-2.8.0.orig/make.check-cuda magma-2.8.0/make.check-cuda
--- magma-2.8.0.orig/make.check-cuda	2024-03-28 05:23:40.000000000 -0700
+++ magma-2.8.0/make.check-cuda	2024-05-06 15:25:58.787054319 -0700
@@ -2,11 +2,11 @@
 ifeq ($(CUDADIR),)
     cuda := $(shell which nvcc | perl -pe 's|/bin/nvcc||')
     ifeq ($(cuda),)
-        cuda := /usr/local/cuda
+        cuda := /opt/cuda
     endif
 $(error Set $$CUDADIR, preferably in your environment, e.g., run "export CUDADIR=$(cuda)" in ~/.bashrc, or "setenv CUDADIR $(cuda)" in ~/.cshrc)
 endif
 
 ifeq ($(wildcard $(CUDADIR)),)
-$(error $$CUDADIR=$(CUDADIR) does not exist. Please set $$CUDADIR to where CUDA is installed. (normally in /usr/local/cuda))
+$(error $$CUDADIR=$(CUDADIR) does not exist. Please set $$CUDADIR to where CUDA is installed. (normally in /opt/cuda))
 endif
diff -urp magma-2.8.0.orig/make.check-hip magma-2.8.0/make.check-hip
--- magma-2.8.0.orig/make.check-hip	2024-03-28 05:24:03.000000000 -0700
+++ magma-2.8.0/make.check-hip	2024-05-06 15:25:58.787054319 -0700
@@ -2,13 +2,13 @@
 ifeq ($(ROCM_PATH),)
     rocm := $(shell which hipcc | perl -pe 's|/bin/hipcc||')
     ifeq ($(rocm),)
-        rocm := /opt/rocm
+        rocm := @ESYSROOT_ROCM_PATH@
     endif
-    $(error Set $$ROCM_PATH, preferably in your environment, e.g., run "export ROCM_PATH=/opt/rocm" in ~/.bashrc, or "setenv ROCM_PATH $(rocm)" in ~/.cshrc)
+    $(error Set $$ROCM_PATH, preferably in your environment, e.g., run "export ROCM_PATH=@ESYSROOT_ROCM_PATH@" in ~/.bashrc, or "setenv ROCM_PATH $(rocm)" in ~/.cshrc)
 endif
 
 ifeq ($(wildcard $(ROCM_PATH)),)
-$(error $$ROCM_PATH=$(ROCM_PATH) does not exist. Please set $$ROCM_PATH to where ROCM is installed. (normally in /opt/rocm))
+$(error $$ROCM_PATH=$(ROCM_PATH) does not exist. Please set $$ROCM_PATH to where ROCM is installed. (normally in @ESYSROOT_ROCM_PATH@))
 endif
 
 # don't compile ROCM platform on CUDA
diff -urp magma-2.8.0.orig/make.check-openblas magma-2.8.0/make.check-openblas
--- magma-2.8.0.orig/make.check-openblas	2024-03-28 05:23:40.000000000 -0700
+++ magma-2.8.0/make.check-openblas	2024-05-06 15:25:58.787054319 -0700
@@ -3,7 +3,7 @@
 # this assumes LAPACK is part of OpenBLAS library.
 
 ifeq ($(OPENBLASDIR),)
-$(error Set $$OPENBLASDIR, preferably in your environment, e.g., run "export OPENBLASDIR=/opt/openblas" in ~/.bashrc, or "setenv OPENBLASDIR /opt/openblas" in ~/.cshrc)
+$(error Set $$OPENBLASDIR, preferably in your environment, e.g., run "export OPENBLASDIR=/usr" in ~/.bashrc, or "setenv OPENBLASDIR /usr" in ~/.cshrc)
 endif
 
 ifeq ($(wildcard $(OPENBLASDIR)),)
diff -urp magma-2.8.0.orig/Makefile magma-2.8.0/Makefile
--- magma-2.8.0.orig/Makefile	2024-03-28 05:30:01.000000000 -0700
+++ magma-2.8.0/Makefile	2024-05-06 15:25:58.787054319 -0700
@@ -21,8 +21,8 @@ include make.inc
 BACKEND     ?= cuda
 
 # set these to their real paths
-CUDADIR     ?= /usr/local/cuda
-ROCM_PATH   ?= /opt/rocm
+CUDADIR     ?= /opt/cuda
+ROCM_PATH   ?= @ESYSROOT_ROCM_PATH@
 
 # require either hip or cuda
 ifeq (,$(findstring $(BACKEND),"hip cuda"))
@@ -117,7 +117,7 @@ LIBS       = $(LIBDIR) $(LIB)
 CPPFLAGS   = $(INC) $(MAGMA_INC)
 
 # where testers look for MAGMA libraries
-RPATH      = -Wl,-rpath,${abspath ./lib}
+RPATH      = -Wl,-rpath,${abspath ./@COND_LIBDIR@}
 
 codegen    = ./tools/codegen.py
 
@@ -513,13 +513,13 @@ test_headers: $(header_gch)
 
 
 # ----- libraries
-libmagma_a      := lib/libmagma.a
-libmagma_so     := lib/libmagma.so
-libblas_fix_a   := lib/libblas_fix.a
+libmagma_a      := @COND_LIBDIR@/libmagma.a
+libmagma_so     := @COND_LIBDIR@/libmagma.so
+libblas_fix_a   := @COND_LIBDIR@/libblas_fix.a
 libtest_a       := testing/libtest.a
 liblapacktest_a := testing/lin/liblapacktest.a
-libsparse_a     := lib/libmagma_sparse.a
-libsparse_so    := lib/libmagma_sparse.so
+libsparse_a     := @COND_LIBDIR@/libmagma_sparse.a
+libsparse_so    := @COND_LIBDIR@/libmagma_sparse.so
 
 
 # static libraries
@@ -788,7 +788,7 @@ testing/clean: testing/lin/clean
 testing/lin/clean:
 	-rm -f $(liblapacktest_a) $(liblapacktest_obj)
 
-# hmm... what should lib/clean do? just the libraries, not objects?
+# hmm... what should lib/clean do? just the libraries, not objects?
 lib/clean: blas_fix/clean sparse/clean
 	-rm -f $(libmagma_a) $(libmagma_so) $(libmagma_obj)
 
@@ -926,7 +926,7 @@ ifneq ($(have_fpic),)
 	@echo "===== shared library $@"
 	$(CXX) $(LDFLAGS) -shared -o $@ \
 		$^ \
-		-L./lib $(LIBS)
+		-L./@COND_LIBDIR@ $(LIBS)
 	@echo
 
     # Can't add -Llib -lmagma to LIBS, because that would apply to libsparse_so's
@@ -936,7 +936,7 @@ ifneq ($(have_fpic),)
 	@echo "===== shared library $@"
 	$(CXX) $(LDFLAGS) -shared -o $@ \
 		$^ \
-		-L./lib $(LIBS) -lmagma
+		-L./@COND_LIBDIR@ $(LIBS) -lmagma
 	@echo
 else
     # missing -fPIC: "make shared" prints warning
@@ -952,7 +952,7 @@ $(testers): %: %.$(o_ext)
 	$(CXX) $(LDFLAGS) $(RPATH) \
 	-o $@ $< \
 	-L./testing -ltest \
-	-L./lib -lmagma \
+	-L./@COND_LIBDIR@ -lmagma \
 	-L./testing/lin -llapacktest \
 	$(LIBS)
 
@@ -962,7 +962,7 @@ $(testers_f): %: %.$(o_ext)
 	-o $@ $< \
 	-L./testing -ltest \
 	-L./testing/lin -llapacktest \
-	-L./lib -lmagma \
+	-L./@COND_LIBDIR@ -lmagma \
 	$(LIBS)
 
 # link sparse testing_foo from testing_foo.o
@@ -970,7 +970,7 @@ $(sparse_testers): %: %.$(o_ext)
 	$(CXX) $(LDFLAGS) $(RPATH) \
 	-o $@ $< \
 	-L./testing -ltest \
-	-L./lib -lmagma_sparse -lmagma \
+	-L./@COND_LIBDIR@ -lmagma_sparse -lmagma \
 	$(LIBS)
 
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.acml magma-2.8.0/make.inc-examples/make.inc.acml
--- magma-2.8.0.orig/make.inc-examples/make.inc.acml	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.acml	2024-05-06 15:25:58.791054289 -0700
@@ -74,12 +74,12 @@ LIB      += -lcublas -lcusparse -lcudart
 
 # define library directories preferably in your environment, or here.
 #ACMLDIR  ?= /opt/acml
-#CUDADIR  ?= /usr/local/cuda
+#CUDADIR  ?= /opt/cuda
 -include make.check-acml
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
-            -L$(ACMLDIR)/gfortran64_mp/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
+            -L$(ACMLDIR)/gfortran64_mp/@ACML_LIBDIR@
 
 INC       = -I$(CUDADIR)/include \
             -I$(ACMLDIR)/gfortran64_mp/include
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.atlas magma-2.8.0/make.inc-examples/make.inc.atlas
--- magma-2.8.0.orig/make.inc-examples/make.inc.atlas	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.atlas	2024-05-06 15:25:58.791054289 -0700
@@ -75,12 +75,12 @@ LIB      += -lcublas -lcusparse -lcudart
 # define library directories preferably in your environment, or here.
 #LAPACKDIR ?= /opt/lapack
-#ATLASDIR  ?= /opt/atlas
+#ATLASDIR  ?= /usr
-#CUDADIR   ?= /usr/local/cuda
+#CUDADIR   ?= /opt/cuda
 -include make.check-atlas
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
             -L$(LAPACKDIR) \
-            -L$(ATLASDIR)/lib
+            -L$(ATLASDIR)/@ABI_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.hip-gcc-mkl magma-2.8.0/make.inc-examples/make.inc.hip-gcc-mkl
--- magma-2.8.0.orig/make.inc-examples/make.inc.hip-gcc-mkl	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.hip-gcc-mkl	2024-05-06 15:27:10.270515189 -0700
@@ -33,8 +33,8 @@
 BACKEND      = hip
 
 # set these to their real paths
-ROCM_PATH ?= /opt/rocm
-CUDADIR   ?= /usr/local/cuda
+ROCM_PATH ?= @ESYSROOT_ROCM_PATH@
+CUDADIR   ?= /opt/cuda
 
 # require either hip or cuda
 ifeq (,$(findstring $(BACKEND),hip cuda))
@@ -90,9 +90,9 @@ FPIC        = -fPIC
 # comment out to build without openmp support
 # NOTE: For some reason, using `-fopenmp` is not enough to add linker flags to
 #   the compiler sometimes, so we need to add -L here too if there are problems
-FOPENMP     = -fopenmp
+#FOPENMP     = -fopenmp
 #FOPENMP     =
-#FOPENMP     = -fopenmp -L$(ROCM_PATH)/lib -I$(ROCM_PATH)/include
+FOPENMP     = -fopenmp -L@ESYSROOT_LLVM_PATH@/@COND_LIBDIR@ -I@ESYSROOT_LLVM_PATH@/include
 
 # now, generate our flags
 CFLAGS      = -O3 $(FPIC) $(FOPENMP) -DNDEBUG -DADD_ -Wall -std=c99
@@ -144,10 +144,10 @@ endif
 #   folders
 ifeq ($(BACKEND),cuda)
     INC    += -I$(CUDADIR)/include
-    LIBDIR += -L$(CUDADIR)/lib64 -L$(MKLROOT)/lib/intel64
+    LIBDIR += -L$(CUDADIR)/@ABI_LIBDIR@ -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 else ifeq ($(BACKEND),hip)
     INC    += -I$(ROCM_PATH)/include
-    LIBDIR += -L$(ROCM_PATH)/lib -L$(MKLROOT)/lib/intel64
+    LIBDIR += -L$(ROCM_PATH)/@ROCM_LIBDIR@ -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 endif
 
 
@@ -156,8 +156,8 @@ endif
 
 # check for MKL
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
 -include make.check-mkl
 
 # checks for the specified backend
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.hip-gcc-openblas magma-2.8.0/make.inc-examples/make.inc.hip-gcc-openblas
--- magma-2.8.0.orig/make.inc-examples/make.inc.hip-gcc-openblas	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.hip-gcc-openblas	2024-05-06 15:27:15.838473160 -0700
@@ -33,9 +33,9 @@
 BACKEND      = hip
 
 # set these to their real paths
-OPENBLASDIR ?= /usr/local/openblas
-ROCM_PATH   ?= /opt/rocm
-CUDADIR     ?= /usr/local/cuda
+OPENBLASDIR ?= /usr
+ROCM_PATH   ?= @ESYSROOT_ROCM_PATH@
+CUDADIR     ?= /opt/cuda
 
 # require either hip or cuda
 ifeq (,$(findstring $(BACKEND),hip cuda))
@@ -94,9 +94,9 @@ FPIC        = -fPIC
 # comment out to build without openmp support
 # NOTE: For some reason, using `-fopenmp` is not enough to add linker flags to
 #   the compiler sometimes, so we need to add -L here too if there are problems
-FOPENMP     = -fopenmp
+#FOPENMP     = -fopenmp
 #FOPENMP     =
-#FOPENMP     = -fopenmp -L$(ROCM_PATH)/lib -I$(ROCM_PATH)/include
+FOPENMP     = -fopenmp -L@ESYSROOT_LLVM_PATH@/@COND_LIBDIR@ -I@ESYSROOT_LLVM_PATH@/include
 
 # now, generate our flags
 CFLAGS      = -O3 $(FPIC) $(FOPENMP) -DNDEBUG -DADD_ -Wall -std=c99
@@ -143,7 +143,7 @@ endif
 # directories
 
 # define library directories preferably in your environment, or here.
-LIBDIR    += -L$(OPENBLASDIR)/lib
+LIBDIR    += -L$(OPENBLASDIR)/@ABI_LIBDIR@
 
 # include each's directories
 # note: we don't need to include the library directories, since nvcc or hipcc
@@ -151,10 +151,10 @@ LIBDIR    += -L$(OPENBLASDIR)/lib
 #   folders
 ifeq ($(BACKEND),cuda)
     INC    += -I$(CUDADIR)/include
-    LIBDIR += -L$(CUDADIR)/lib64
+    LIBDIR += -L$(CUDADIR)/@ABI_LIBDIR@
 else ifeq ($(BACKEND),hip)
     INC    += -I$(ROCM_PATH)/include
-    LIBDIR += -L$(ROCM_PATH)/lib
+    LIBDIR += -L$(ROCM_PATH)/@ROCM_LIBDIR@
 endif
 
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.macos magma-2.8.0/make.inc-examples/make.inc.macos
--- magma-2.8.0.orig/make.inc-examples/make.inc.macos	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.macos	2024-05-06 15:25:58.791054289 -0700
@@ -83,10 +83,10 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-#CUDADIR ?= /usr/local/cuda
+#CUDADIR ?= /opt/cuda
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.macos-debug magma-2.8.0/make.inc-examples/make.inc.macos-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.macos-debug	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.macos-debug	2024-05-06 15:25:58.791054289 -0700
@@ -83,10 +83,10 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-#CUDADIR ?= /usr/local/cuda
+#CUDADIR ?= /opt/cuda
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.macos-mkl magma-2.8.0/make.inc-examples/make.inc.macos-mkl
--- magma-2.8.0.orig/make.inc-examples/make.inc.macos-mkl	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.macos-mkl	2024-05-06 15:25:58.791054289 -0700
@@ -75,10 +75,10 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-#CUDADIR ?= /usr/local/cuda
+#CUDADIR ?= /opt/cuda
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib \
-            -L$(MKLROOT)/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
+            -L$(MKLROOT)/@MKL_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.macos-openmp magma-2.8.0/make.inc-examples/make.inc.macos-openmp
--- magma-2.8.0.orig/make.inc-examples/make.inc.macos-openmp	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.macos-openmp	2024-05-06 15:25:58.791054289 -0700
@@ -83,10 +83,10 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-#CUDADIR ?= /usr/local/cuda
+#CUDADIR ?= /opt/cuda
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc magma-2.8.0/make.inc-examples/make.inc.mkl-gcc
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-gcc	2024-05-06 15:25:58.791054289 -0700
@@ -71,13 +71,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-debug magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-debug	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-debug	2024-05-06 15:25:58.791054289 -0700
@@ -71,13 +71,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-ilp64 magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-ilp64
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-ilp64	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-ilp64	2024-05-06 15:25:58.791054289 -0700
@@ -87,13 +87,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-ilp64-debug magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-ilp64-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-gcc-ilp64-debug	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-gcc-ilp64-debug	2024-05-06 15:25:58.791054289 -0700
@@ -87,13 +87,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc magma-2.8.0/make.inc-examples/make.inc.mkl-icc
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-icc	2024-05-06 15:25:58.791054289 -0700
@@ -66,13 +66,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-debug magma-2.8.0/make.inc-examples/make.inc.mkl-icc-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-debug	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-icc-debug	2024-05-06 15:25:58.795054259 -0700
@@ -66,13 +66,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-ilp64 magma-2.8.0/make.inc-examples/make.inc.mkl-icc-ilp64
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-ilp64	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-icc-ilp64	2024-05-06 15:25:58.795054259 -0700
@@ -82,13 +82,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-ilp64-debug magma-2.8.0/make.inc-examples/make.inc.mkl-icc-ilp64-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.mkl-icc-ilp64-debug	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.mkl-icc-ilp64-debug	2024-05-06 15:25:58.795054259 -0700
@@ -82,13 +82,13 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-# for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64
-#MKLROOT ?= /opt/intel/composerxe/mkl
-#CUDADIR ?= /usr/local/cuda
+# for MKL run, e.g.: source /opt/intel/oneapi/mkl/latest/bin/mklvars.sh intel64
+#MKLROOT ?= /opt/intel/oneapi/mkl/latest
+#CUDADIR ?= /opt/cuda
 -include make.check-mkl
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
-            -L$(MKLROOT)/lib/intel64
+            -L$(MKLROOT)/@MKL_LIBDIR@/intel64
 
 INC       = -I$(CUDADIR)/include \
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.openblas magma-2.8.0/make.inc-examples/make.inc.openblas
--- magma-2.8.0.orig/make.inc-examples/make.inc.openblas	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.openblas	2024-05-06 15:25:58.795054259 -0700
@@ -16,9 +16,9 @@
 BACKEND     ?= cuda
 
 # set these to their real paths
-OPENBLASDIR ?= /usr/local/openblas
-CUDADIR     ?= /usr/local/cuda
-ROCM_PATH   ?= /opt/rocm
+OPENBLASDIR ?= /usr
+CUDADIR     ?= /opt/cuda
+ROCM_PATH   ?= @ESYSROOT_ROCM_PATH@
 
 # require either hip or cuda
 ifeq (,$(findstring $(BACKEND),hip cuda))
@@ -85,7 +85,7 @@ LIB       += -lopenblas
 # directories
 
 # define library directories preferably in your environment, or here.
-LIBDIR    += -L$(OPENBLASDIR)/lib
+LIBDIR    += -L$(OPENBLASDIR)/@ABI_LIBDIR@
 INC       +=
 
 
@@ -107,7 +107,7 @@ ifeq ($(BACKEND),cuda)
 
     # link with cuda specific libraries
     INC    += -I$(CUDADIR)/include
-    LIBDIR += -L$(CUDADIR)/lib64
+    LIBDIR += -L$(CUDADIR)/@ABI_LIBDIR@
     LIB    += -lcublas -lcusparse -lcudart -lcudadevrt
 endif
 
@@ -118,7 +118,7 @@ ifeq ($(BACKEND),hip)
     DEVCCFLAGS += $(FPIC) -std=c++11
 
     INC    += -I$(ROCM_PATH)/include
-    LIBDIR += -L$(ROCM_PATH)/lib
+    LIBDIR += -L$(ROCM_PATH)/@ROCM_LIBDIR@
     LIB    += -lhipblas -lhipsparse
 endif
 
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.openblas-debug magma-2.8.0/make.inc-examples/make.inc.openblas-debug
--- magma-2.8.0.orig/make.inc-examples/make.inc.openblas-debug	2024-03-28 05:22:51.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.openblas-debug	2024-05-06 15:25:58.795054259 -0700
@@ -65,12 +65,12 @@ LIB      += -lcublas -lcusparse -lcudart
 # directories
 
 # define library directories preferably in your environment, or here.
-#OPENBLASDIR ?= /usr/local/openblas
-#CUDADIR ?= /usr/local/cuda
+#OPENBLASDIR ?= /usr
+#CUDADIR ?= /opt/cuda
 -include make.check-openblas
 -include make.check-cuda
 
-LIBDIR    = -L$(CUDADIR)/lib64 \
-            -L$(OPENBLASDIR)/lib
+LIBDIR    = -L$(CUDADIR)/@ABI_LIBDIR@ \
+            -L$(OPENBLASDIR)/@ABI_LIBDIR@
 
 INC       = -I$(CUDADIR)/include
diff -urp magma-2.8.0.orig/make.inc-examples/make.inc.power9-essl magma-2.8.0/make.inc-examples/make.inc.power9-essl
--- magma-2.8.0.orig/make.inc-examples/make.inc.power9-essl	2024-03-28 05:22:50.000000000 -0700
+++ magma-2.8.0/make.inc-examples/make.inc.power9-essl	2024-05-06 15:25:58.795054259 -0700
@@ -65,12 +65,12 @@ LIB      += -lcublas -lcusparse -lcudart
 
 # define library directories preferably in your environment, or here.
 #OLCF_ESSL_ROOT ?= /opt/essl
-#OLCF_CUDA_ROOT ?= /usr/local/cuda
+#OLCF_CUDA_ROOT ?= /opt/cuda
 #-include make.check-cuda
 #OLCF_NETLIB_LAPACK_ROOT ?= /opt/netlib-lapack
 
-LIBDIR    = -L$(OLCF_CUDA_ROOT)/lib64 \
-            -L$(OLCF_ESSL_ROOT)/lib64 -L$(OLCF_NETLIB_LAPACK_ROOT)/lib64
+LIBDIR    = -L$(OLCF_CUDA_ROOT)/@ABI_LIBDIR@ \
+            -L$(OLCF_ESSL_ROOT)/@OLCF_ESSL_LIBDIR@ -L$(OLCF_NETLIB_LAPACK_ROOT)/@LIBDIR@
 
 INC       = -I$(OLCF_CUDA_ROOT)/include \
             -I$(OLCF_ESSL_ROOT)/include -I$(OLCF_NETLIB_LAPACK_ROOT)/include
diff -urp magma-2.8.0.orig/sparse_hip/testing/testing_zparilu.cpp magma-2.8.0/sparse_hip/testing/testing_zparilu.cpp
--- magma-2.8.0.orig/sparse_hip/testing/testing_zparilu.cpp	2024-03-28 05:24:24.000000000 -0700
+++ magma-2.8.0/sparse_hip/testing/testing_zparilu.cpp	2024-05-06 15:25:58.795054259 -0700
@@ -17,8 +17,13 @@
 
 // includes CUDA
 #include <hip/hip_runtime_api.h>
+#if HIP_VERSION >= 50200000
+#include <hipblas/hipblas.h>
+#include <hipsparse/hipsparse.h>
+#else
 #include <hipblas.h>
 #include <hipsparse.h>
+#endif
 #include <hip/hip_profile.h>
 
 // includes, project
diff -urp magma-2.8.0.orig/sparse_hip/testing/testing_zparilu_weight.cpp magma-2.8.0/sparse_hip/testing/testing_zparilu_weight.cpp
--- magma-2.8.0.orig/sparse_hip/testing/testing_zparilu_weight.cpp	2024-03-28 05:24:24.000000000 -0700
+++ magma-2.8.0/sparse_hip/testing/testing_zparilu_weight.cpp	2024-05-06 15:25:58.795054259 -0700
@@ -18,8 +18,13 @@
 
 // includes CUDA
 #include <hip/hip_runtime_api.h>
+#if HIP_VERSION >= 50200000
+#include <hipblas/hipblas.h>
+#include <hipsparse/hipsparse.h>
+#else
 #include <hipblas.h>
 #include <hipsparse.h>
+#endif
 #include <hip/hip_profile.h>
 
 // includes, project
diff -urp magma-2.8.0.orig/testing/lin/Makefile.src magma-2.8.0/testing/lin/Makefile.src
--- magma-2.8.0.orig/testing/lin/Makefile.src	2024-03-28 05:23:04.000000000 -0700
+++ magma-2.8.0/testing/lin/Makefile.src	2024-05-06 15:25:58.795054259 -0700
@@ -277,28 +277,28 @@ xlintsts : $(ALINTST) $(SLINTST) $(SCLNT
 	$(FORT) $(ALINTST) $(SCLNTST) $(SLINTST) \
 	$(TMGLIB) -o xlintsts \
 	testing/fortran.$(o_ext) \
-	$(LDFLAGS) -L$(MAGMA_DIR)/lib -lmagma \
+	$(LDFLAGS) -L$(MAGMA_DIR)/@COND_LIBDIR@ -lmagma \
 	$(LIBDIR) $(LIB)
 
 xlintstc : $(ALINTST) $(CLINTST) $(SCLNTST) testing/fortran.$(o_ext) $(TMGLIB)
 	$(FORT) $(ALINTST) $(SCLNTST) $(CLINTST) \
 	$(TMGLIB) -o xlintstc \
 	testing/fortran.$(o_ext) \
-	$(LDFLAGS) -L$(MAGMA_DIR)/lib -lmagma \
+	$(LDFLAGS) -L$(MAGMA_DIR)/@COND_LIBDIR@ -lmagma \
 	$(LIBDIR) $(LIB)
  
 xlintstd : $(ALINTST) $(DLINTST) $(DZLNTST) testing/fortran.$(o_ext) $(TMGLIB)
 	$(FORT) $(ALINTST) $(DLINTST) $(DZLNTST) \
 	$(TMGLIB) -o xlintstd \
 	testing/fortran.$(o_ext) \
-	$(LDFLAGS) -L$(MAGMA_DIR)/lib -lmagma \
+	$(LDFLAGS) -L$(MAGMA_DIR)/@COND_LIBDIR@ -lmagma \
 	$(LIBDIR) $(LIB)
  
 xlintstz : $(ALINTST) $(ZLINTST) $(DZLNTST) testing/fortran.$(o_ext) $(TMGLIB)
 	$(FORT) $(ALINTST) $(DZLNTST) $(ZLINTST) \
 	$(TMGLIB) -o xlintstz \
 	testing/fortran.$(o_ext) \
-	$(LDFLAGS) -L$(MAGMA_DIR)/lib -lmagma \
+	$(LDFLAGS) -L$(MAGMA_DIR)/@COND_LIBDIR@ -lmagma \
 	$(LIBDIR) $(LIB)
  
 $(ALINTST): $(FRC)
diff -urp magma-2.8.0.orig/testing/testing_veclib.cpp magma-2.8.0/testing/testing_veclib.cpp
--- magma-2.8.0.orig/testing/testing_veclib.cpp	2024-03-28 05:23:26.000000000 -0700
+++ magma-2.8.0/testing/testing_veclib.cpp	2024-05-06 15:25:58.795054259 -0700
@@ -14,7 +14,7 @@
 // Oddly, with -m32 both return float and double for single precision functions works.
 // This is essentially a bug from an old f2c version of lapack (clapack).
 //
-// We work around this bug by putting replacement routines in the magma/lib/libblas_fix.a library.
+// We work around this bug by putting replacement routines in the magma/@COND_LIBDIR@/libblas_fix.a library.
 // These correctly return float for the single precision functions that had issues.
 
 #include <stdio.h>
diff -urp magma-2.8.0.orig/tools/build.sh magma-2.8.0/tools/build.sh
--- magma-2.8.0.orig/tools/build.sh	2024-03-28 05:23:41.000000000 -0700
+++ magma-2.8.0/tools/build.sh	2024-05-06 15:25:58.795054259 -0700
@@ -155,14 +155,14 @@ for config in $@; do
         echo "SKIPPING SPARSE"
     fi
 
-    mkdir $builds/$config/lib
+    mkdir $builds/$config/@COND_LIBDIR@
     mkdir $builds/$config/testing
 
     mkdir $builds/$config/sparse
     mkdir $builds/$config/sparse/testing
 
     # link libraries
-    ln lib/lib*       $builds/$config/lib
+    ln lib/lib*       $builds/$config/@COND_LIBDIR@
 
     # link testers
     ln `find testing        -maxdepth 1 -perm -u+x -type f -not -name '*.py' -not -name '*.pl' -not -name '*.sh' -not -name '*.csh'` $builds/$config/testing
