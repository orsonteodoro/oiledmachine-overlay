diff -urp rocMLIR-rocm-5.5.0.orig/cmake/llvm-project.cmake rocMLIR-rocm-5.5.0/cmake/llvm-project.cmake
--- rocMLIR-rocm-5.5.0.orig/cmake/llvm-project.cmake	2023-01-04 06:20:51.000000000 -0800
+++ rocMLIR-rocm-5.5.0/cmake/llvm-project.cmake	2023-08-06 16:22:56.681365577 -0700
@@ -6,7 +6,11 @@ set(MLIR_CMAKE_CONFIG_DIR
    "${CMAKE_BINARY_DIR}/lib${LLVM_LIBDIR_SUFFIX}/cmake/mlir")
 
 # MLIR settings
-set(MLIR_TABLEGEN_EXE mlir-tblgen)
+if(USE_SYSTEM_MLIR)
+  set(MLIR_TABLEGEN_EXE /usr/lib/llvm/${LLVM_VERSION_MAJOR}/bin/mlir-tblgen)
+else()
+  set(MLIR_TABLEGEN_EXE mlir-tblgen)
+endif()
 
 # LLVM settings
 set(LLVM_ENABLE_PROJECTS "mlir;lld" CACHE STRING "List of default llvm targets")
@@ -14,7 +18,7 @@ set(LLVM_BUILD_EXAMPLES ON CACHE BOOL ""
 set(LLVM_INSTALL_UTILS ON CACHE BOOL "")
 set(LLVM_ENABLE_TERMINFO OFF CACHE BOOL "")
 set(LLVM_ENABLE_ASSERTIONS ON CACHE BOOL "")
-set(LLVM_PROJ_SRC "${CMAKE_SOURCE_DIR}/external/llvm-project")
+set(LLVM_VERSION_MAJOR ${ELLVM_VERSION_MAJOR})
 
 # Configure ROCm support.
 if (NOT DEFINED ROCM_PATH)
@@ -30,27 +34,53 @@ message(STATUS "ROCM_PATH: ${ROCM_PATH}"
 list(APPEND CMAKE_MODULE_PATH
   "${ROCM_PATH}/hip/cmake"
 )
-list(APPEND CMAKE_MODULE_PATH
-  "${CMAKE_CURRENT_BINARY_DIR}/lib/cmake/mlir"
-)
-list(APPEND CMAKE_MODULE_PATH
-  "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib/cmake/llvm/"
-)
+
+if(USE_SYSTEM_MLIR)
+  list(APPEND CMAKE_MODULE_PATH
+    "/usr/lib/llvm/${LLVM_VERSION_MAJOR}/${CMAKE_INSTALL_LIBDIR}/cmake/mlir"
+  )
+  list(APPEND CMAKE_MODULE_PATH
+    "/usr/lib/llvm/${LLVM_VERSION_MAJOR}/${CMAKE_INSTALL_LIBDIR}/cmake/llvm"
+  )
+
+  set(LLVM_INCLUDE_DIR1 /usr/lib/llvm/${LLVM_VERSION_MAJOR}/include)
+  set(LLVM_INCLUDE_DIR2 "")
+  set(MLIR_INCLUDE_DIR1 /usr/lib/llvm/${LLVM_VERSION_MAJOR}/include)
+  set(MLIR_INCLUDE_DIR2 "")
+else()
+  list(APPEND CMAKE_MODULE_PATH
+    "${CMAKE_CURRENT_BINARY_DIR}/lib/cmake/mlir"
+  )
+  list(APPEND CMAKE_MODULE_PATH
+    "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib/cmake/llvm/"
+  )
+
+  set(LLVM_INCLUDE_DIR1 ${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/llvm/include)
+  set(LLVM_INCLUDE_DIR2 ${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/include)
+  set(MLIR_INCLUDE_DIR1 ${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/mlir/include)
+  set(MLIR_INCLUDE_DIR2 ${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/tools/mlir/include)
+endif()
 
 # Include dirs for MLIR and LLVM
 list(APPEND MLIR_INCLUDE_DIRS
-  ${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/mlir/include
-  ${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/tools/mlir/include
+  ${MLIR_INCLUDE_DIR1}
+  ${MLIR_INCLUDE_DIR2}
 )
 list(APPEND LLVM_INCLUDE_DIRS
-  ${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/llvm/include
-  ${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/include
+  ${LLVM_INCLUDE_DIR1}
+  ${LLVM_INCLUDE_DIR2}
 )
 
-# Linker flags
-set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,-rpath -Wl,${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib")
-
-add_subdirectory("${LLVM_PROJ_SRC}/llvm" "external/llvm-project/llvm" EXCLUDE_FROM_ALL)
+if(USE_SYSTEM_MLIR)
+  # Linker flags
+  set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,-rpath -Wl,/usr/lib/llvm/${LLVM_VERSION_MAJOR}/include")
+  # System MLIR already built
+else()
+  # Linker flags
+  set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,-rpath -Wl,${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib")
+  set(LLVM_PROJ_SRC "${CMAKE_SOURCE_DIR}/external/llvm-project")
+  add_subdirectory("${LLVM_PROJ_SRC}/llvm" "external/llvm-project/llvm" EXCLUDE_FROM_ALL)
+endif()
 
 function(add_rocmlir_dialect_library name)
   set_property(GLOBAL APPEND PROPERTY ROCMLIR_DIALECT_LIBS ${name})
diff -urp rocMLIR-rocm-5.5.0.orig/CMakeLists.txt rocMLIR-rocm-5.5.0/CMakeLists.txt
--- rocMLIR-rocm-5.5.0.orig/CMakeLists.txt	2023-01-04 06:20:51.000000000 -0800
+++ rocMLIR-rocm-5.5.0/CMakeLists.txt	2023-08-06 15:52:20.473317751 -0700
@@ -38,10 +38,17 @@ set(ROCK_E2E_TEST_ENABLED 0 CACHE BOOL "
 # LLVM settings that have an effect on the MLIR dialect
 set(LLVM_TARGETS_TO_BUILD "X86;AMDGPU" CACHE STRING "")
 
-# Pointers to: 1) external LLVM bins/libs, and 2) Rock Dialect bins/libs
-set(LLVM_MAIN_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/llvm" CACHE PATH "Path to LLVM sources")
-set(LLVM_EXTERNAL_BIN_DIR "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/bin" CACHE PATH "")
-set(LLVM_EXTERNAL_LIB_DIR "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib" CACHE PATH "")
+option(USE_SYSTEM_MLIR "Use the system MLIR instead of the vendored" ON)
+if (NOT USE_SYSTEM_MLIR)
+  # Pointers to: 1) external LLVM bins/libs, and 2) Rock Dialect bins/libs
+  set(LLVM_MAIN_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/external/llvm-project/llvm" CACHE PATH "Path to LLVM sources")
+  set(LLVM_EXTERNAL_BIN_DIR "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/bin" CACHE PATH "")
+  set(LLVM_EXTERNAL_LIB_DIR "${CMAKE_CURRENT_BINARY_DIR}/external/llvm-project/llvm/lib" CACHE PATH "")
+else()
+  set(LLVM_VERSION_MAJOR ${ELLVM_VERSION_MAJOR})
+  set(LLVM_EXTERNAL_BIN_DIR "/usr/lib/llvm/${LLVM_VERSION_MAJOR}/bin" CACHE PATH "")
+  set(LLVM_EXTERNAL_LIB_DIR "/usr/lib/llvm/${LLVM_VERSION_MAJOR}/${CMAKE_INSTALL_LIBDIR}" CACHE PATH "")
+endif()
 set(ROCMLIR_BIN_DIR "${CMAKE_CURRENT_BINARY_DIR}/bin" CACHE PATH "")
 set(ROCMLIR_LIB_DIR "${CMAKE_CURRENT_BINARY_DIR}/lib" CACHE PATH "")
 message(STATUS "LLVM_EXTERNAL_BIN_DIR: ${LLVM_EXTERNAL_BIN_DIR}")
@@ -51,11 +58,16 @@ message(STATUS "ROCMLIR_BIN_DIR: ${ROCML
 set(CMAKE_BUILD_RPATH "${ROCMLIR_LIB_DIR};${LLVM_EXTERNAL_LIB_DIR}")
 message(STATUS "CMAKE_BUILD_RPATH: ${CMAKE_BUILD_RPATH}")
 
-if(BUILD_MIXR_TARGET)
+if(BUILD_MIXR_TARGET AND NOT USE_SYSTEM_MLIR)
   set(BUILD_FAT_LIBROCKCOMPILER ON CACHE BOOL "Build static librockCompiler")
   set(EXPORT_ALL_HEADERS ON CACHE BOOL "Export internal headers")
 endif()
 
+if(USE_SYSTEM_MLIR)
+  set(BUILD_FAT_LIBROCKCOMPILER OFF)
+  set(EXPORT_ALL_HEADERS OFF)
+endif()
+
 # Library type and linkage settings
 if( NOT DEFINED BUILD_FAT_LIBROCKCOMPILER )
   set(BUILD_FAT_LIBROCKCOMPILER OFF CACHE BOOL "Build fat librockCompiler to link into Rock driver")
diff -urp rocMLIR-rocm-5.5.0.orig/mlir/CMakeLists.txt rocMLIR-rocm-5.5.0/mlir/CMakeLists.txt
--- rocMLIR-rocm-5.5.0.orig/mlir/CMakeLists.txt	2023-08-06 15:51:52.557317024 -0700
+++ rocMLIR-rocm-5.5.0/mlir/CMakeLists.txt	2023-08-06 15:52:20.473317751 -0700
@@ -16,6 +16,12 @@ set(MLIR_SOURCE_DIR ${CMAKE_CURRENT_SOUR
 
 list(APPEND CMAKE_MODULE_PATH "${MLIR_CMAKE_DIR}")
 list(APPEND CMAKE_MODULE_PATH "${LLVM_CMAKE_DIR}")
+if(USE_SYSTEM_MLIR)
+  find_package(MLIR)
+#  add_custom_target(mlir-generic-headers)
+#  add_custom_target(mlir-headers)
+#  add_custom_target(mlir-doc)
+endif()
 include(TableGen)
 include(AddLLVM)
 include(AddMLIR)
@@ -42,7 +48,7 @@ add_subdirectory(lib)
 # C API needs all dialects for registration, but should be built before tests.
 add_subdirectory(lib/CAPI)
 
-if (MLIR_INCLUDE_TESTS)
+if (MLIR_INCLUDE_TESTS AND NOT USE_SYSTEM_MLIR)
   add_definitions(-DMLIR_INCLUDE_TESTS)
   add_custom_target(RocMLIRUnitTests)
   if (EXISTS ${LLVM_MAIN_SRC_DIR}/utils/unittest/googletest/include/gtest/gtest.h)
diff -urp rocMLIR-rocm-5.5.0.orig/mlir/test/CMakeLists.txt rocMLIR-rocm-5.5.0/mlir/test/CMakeLists.txt
--- rocMLIR-rocm-5.5.0.orig/mlir/test/CMakeLists.txt	2023-01-04 06:20:51.000000000 -0800
+++ rocMLIR-rocm-5.5.0/mlir/test/CMakeLists.txt	2023-08-06 15:52:20.517317753 -0700
@@ -35,7 +35,11 @@ message(STATUS "MLIR_CONV_VALIDATION_WRA
 
 # Need to explicitly give paths to llvm tools
 set(LLVM_LIT_TOOLS_DIR ${LLVM_EXTERNAL_BIN_DIR})
-set(LLVM_EXTERNAL_LIT "${LLVM_LIT_TOOLS_DIR}/llvm-lit")
+if(USE_SYSTEM_MLIR)
+  set(LLVM_EXTERNAL_LIT "/usr/bin/lit")
+else()
+  set(LLVM_EXTERNAL_LIT "${LLVM_LIT_TOOLS_DIR}/llvm-lit")
+endif()
 set(LLVM_TOOLS_DIR ${LLVM_EXTERNAL_BIN_DIR})
 set(MLIR_TOOLS_DIR ${LLVM_EXTERNAL_BIN_DIR})
 set(ROCMLIR_TOOLS_DIR ${ROCMLIR_BIN_DIR})
diff -urp rocMLIR-rocm-5.5.0.orig/mlir/tools/rocmlir-lib/CMakeLists.txt rocMLIR-rocm-5.5.0/mlir/tools/rocmlir-lib/CMakeLists.txt
--- rocMLIR-rocm-5.5.0.orig/mlir/tools/rocmlir-lib/CMakeLists.txt	2023-01-04 06:20:51.000000000 -0800
+++ rocMLIR-rocm-5.5.0/mlir/tools/rocmlir-lib/CMakeLists.txt	2023-08-06 15:52:20.517317753 -0700
@@ -7,7 +7,12 @@ set(LIBS
   LLVMX86AsmParser
 )
 
-set(CMAKE_BUILD_RPATH ${CMAKE_BUILD_DIR}/external/llvm-project/llvm/lib)
+message(STATUS "LLVM_VERSION_MAJOR=${LLVM_VERSION_MAJOR} CMAKE_INSTALL_LIBDIR=${CMAKE_INSTALL_LIBDIR} USE_SYSTEM_MLIR=${USE_SYSTEM_MLIR}")
+if(USE_SYSTEM_MLIR)
+  set(CMAKE_BUILD_RPATH /usr/lib/llvm/${LLVM_VERSION_MAJOR}/${CMAKE_INSTALL_LIBDIR})
+else()
+  set(CMAKE_BUILD_RPATH ${CMAKE_BUILD_DIR}/external/llvm-project/llvm/lib)
+endif()
 
 llvm_add_library(MLIRRockThin
 PARTIAL_SOURCES_INTENDED
diff -urp rocMLIR-rocm-5.5.0.orig/mlir/utils/performance/CMakeLists.txt rocMLIR-rocm-5.5.0/mlir/utils/performance/CMakeLists.txt
--- rocMLIR-rocm-5.5.0.orig/mlir/utils/performance/CMakeLists.txt	2023-01-04 06:20:51.000000000 -0800
+++ rocMLIR-rocm-5.5.0/mlir/utils/performance/CMakeLists.txt	2023-08-06 15:52:20.517317753 -0700
@@ -14,5 +14,7 @@ set(PERFORMANCE_SCRIPTS
 
 list(TRANSFORM PERFORMANCE_SCRIPTS PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")
 
-add_custom_target(ci-performance-scripts
-	COMMAND ${CMAKE_COMMAND} -E copy ${PERFORMANCE_SCRIPTS} ${ROCMLIR_BIN_DIR})
+if (NOT USE_SYSTEM_MLIR)
+	add_custom_target(ci-performance-scripts
+		COMMAND ${CMAKE_COMMAND} -E copy ${PERFORMANCE_SCRIPTS} ${ROCMLIR_BIN_DIR})
+endif()
