diff '--color=auto' -urp pytorch-2.4.0.orig/scripts/fbcode-dev-setup/ccache_setup.sh pytorch-2.4.0/scripts/fbcode-dev-setup/ccache_setup.sh
--- pytorch-2.4.0.orig/scripts/fbcode-dev-setup/ccache_setup.sh	2024-07-09 11:17:43.000000000 -0700
+++ pytorch-2.4.0/scripts/fbcode-dev-setup/ccache_setup.sh	2024-08-10 21:31:11.493812239 -0700
@@ -40,8 +40,8 @@ done
 set +e
 nvcc_path=$(which nvcc)
 if [[ -z "$nvcc_path" ]]; then
-  nvcc_path="/usr/local/cuda/bin/nvcc"
-  export PATH="/usr/local/cuda/bin:$PATH"
+  nvcc_path="/opt/cuda/bin/nvcc"
+  export PATH="/opt/cuda/bin:$PATH"
 fi
 set -e
 if [ ! -f "$nvcc_path" ] && ! $force; then
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/FBGEMM/fbgemm_gpu/setup.py pytorch-2.4.0/third_party/FBGEMM/fbgemm_gpu/setup.py
--- pytorch-2.4.0.orig/third_party/FBGEMM/fbgemm_gpu/setup.py	2023-12-04 14:00:48.000000000 -0800
+++ pytorch-2.4.0/third_party/FBGEMM/fbgemm_gpu/setup.py	2024-08-10 21:30:32.566465146 -0700
@@ -94,7 +94,7 @@ def find_cuda(major: int, minor: int) ->
     if nvcc_ok(cuda_home, major, minor):
         return cuda_home
 
-    cuda_home = "/usr/local/cuda"
+    cuda_home = "/opt/cuda"
     if nvcc_ok(cuda_home, major, minor):
         return cuda_home
 
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/FBGEMM/third_party/cutlass/test/unit/nvrtc/thread/testbed.h pytorch-2.4.0/third_party/FBGEMM/third_party/cutlass/test/unit/nvrtc/thread/testbed.h
--- pytorch-2.4.0.orig/third_party/FBGEMM/third_party/cutlass/test/unit/nvrtc/thread/testbed.h	2022-09-15 13:20:33.000000000 -0700
+++ pytorch-2.4.0/third_party/FBGEMM/third_party/cutlass/test/unit/nvrtc/thread/testbed.h	2024-08-10 21:31:38.661356577 -0700
@@ -201,7 +201,7 @@ struct Testbed {
 
     const char *opts[] = {"--gpu-architecture=compute_75",
                           "--std=c++11",
-                          "--include-path=/usr/local/cuda-10.1/include"};
+                          "--include-path=/opt/cuda/include"};
 
     result_nvrtc = nvrtcCompileProgram(program, 3, opts);
     if (result_nvrtc != NVRTC_SUCCESS) {
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/aotriton/third_party/triton/python/tutorials/07-math-functions.py pytorch-2.4.0/third_party/aotriton/third_party/triton/python/tutorials/07-math-functions.py
--- pytorch-2.4.0.orig/third_party/aotriton/third_party/triton/python/tutorials/07-math-functions.py	2024-03-29 12:41:35.000000000 -0700
+++ pytorch-2.4.0/third_party/aotriton/third_party/triton/python/tutorials/07-math-functions.py	2024-08-10 21:30:16.390736454 -0700
@@ -62,7 +62,7 @@ print(f'The maximum difference between t
 
 output_triton = torch.empty_like(x)
 asin_kernel[grid](x, output_triton, n_elements, BLOCK_SIZE=1024,
-                  extern_libs={'libdevice': '/usr/local/cuda/nvvm/libdevice/libdevice.10.bc'})
+                  extern_libs={'libdevice': '/opt/cuda/nvvm/libdevice/libdevice.10.bc'})
 print(output_torch)
 print(output_triton)
 print(f'The maximum difference between torch and triton is '
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/kineto/libkineto/sample_programs/build.sh pytorch-2.4.0/third_party/kineto/libkineto/sample_programs/build.sh
--- pytorch-2.4.0.orig/third_party/kineto/libkineto/sample_programs/build.sh	2024-05-24 15:11:03.000000000 -0700
+++ pytorch-2.4.0/third_party/kineto/libkineto/sample_programs/build.sh	2024-08-10 21:28:59.400027797 -0700
@@ -10,11 +10,11 @@ g++ \
   -O0 \
   kineto_playground.cpp \
   -o main \
-  -I/usr/local/cuda/include \
+  -I/opt/cuda/include \
   -I../third_party/fmt/include \
   -I/usr/local/include/kineto \
   -L/usr/local/lib \
-  -L/usr/local/cuda/lib64 \
+  -L/opt/cuda/lib64 \
   -lpthread \
   -lcuda \
   -lcudart \
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/cmake/FindCuda.cmake pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/cmake/FindCuda.cmake
--- pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/cmake/FindCuda.cmake	2022-03-07 15:21:14.000000000 -0800
+++ pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/cmake/FindCuda.cmake	2024-08-10 21:34:05.986885637 -0700
@@ -1,8 +1,8 @@
 include(utils)
 
-set(Cuda9_prefix usr/local/cuda-9.2)
-set(Cuda10_prefix usr/local/cuda-10.0)
-set(Cuda11_prefix usr/local/cuda-11.0)
+set(Cuda9_prefix opt/cuda)
+set(Cuda10_prefix opt/cuda)
+set(Cuda11_prefix opt/cuda)
 
 macro (load_cuda cuda_version)
     foreach (prefix ${Cuda${cuda_version}_prefix})
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/dcgmproftester/buildptx.sh pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/dcgmproftester/buildptx.sh
--- pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/dcgmproftester/buildptx.sh	2022-03-07 15:21:14.000000000 -0800
+++ pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/dcgmproftester/buildptx.sh	2024-08-10 21:29:52.743133086 -0700
@@ -14,4 +14,4 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-/usr/local/cuda/bin/nvcc -ptx -m64 -o DcgmProfTesterKernels.ptx DcgmProfTesterKernels.cu || die "Failed to compile DcgmProfTesterKernels.cu"
+/opt/cuda/bin/nvcc -ptx -m64 -o DcgmProfTesterKernels.ptx DcgmProfTesterKernels.cu || die "Failed to compile DcgmProfTesterKernels.cu"
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/diagnostic/build_ptx_string.sh pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/diagnostic/build_ptx_string.sh
--- pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/diagnostic/build_ptx_string.sh	2022-03-07 15:21:14.000000000 -0800
+++ pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/diagnostic/build_ptx_string.sh	2024-08-10 21:29:44.183276657 -0700
@@ -20,6 +20,6 @@
 #
 # sm_30 is used here for Kepler or newer
 
-/usr/local/cuda/bin/nvcc -arch=sm_30 -ptx -keep compare.cu
+/opt/cuda/bin/nvcc -arch=sm_30 -ptx -keep compare.cu
 bin2c compare.ptx --padd 0 --name gpuburn_ptx_string > gpuburn_ptx_string.h
 python find_ptx_symbols.py compare.ptx gpuburn_ptx_string.h
diff '--color=auto' -urp pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/software/Software.cpp pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/software/Software.cpp
--- pytorch-2.4.0.orig/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/software/Software.cpp	2022-03-07 15:21:14.000000000 -0800
+++ pytorch-2.4.0/third_party/kineto/third_party/dynolog/third_party/DCGM/nvvs/plugin_src/software/Software.cpp	2024-08-10 21:29:28.679536697 -0700
@@ -245,7 +245,7 @@ bool Software::checkLibraries(libraryChe
     if (checkLib == CHECK_CUDATK && fail == true)
     {
         AddInfo("The CUDA Toolkit libraries could not be found.");
-        AddInfo("Is LD_LIBRARY_PATH set to the 64-bit library path? (usually /usr/local/cuda/lib64)");
+        AddInfo("Is LD_LIBRARY_PATH set to the 64-bit library path? (usually /opt/cuda/lib64)");
         AddInfo("Some tests will not run.");
     }
     if (checkLib == CHECK_CUDA && fail == true)
diff '--color=auto' -urp pytorch-2.4.0.orig/torch/utils/collect_env.py pytorch-2.4.0/torch/utils/collect_env.py
--- pytorch-2.4.0.orig/torch/utils/collect_env.py	2024-07-09 11:17:43.000000000 -0700
+++ pytorch-2.4.0/torch/utils/collect_env.py	2024-08-10 21:28:28.712542516 -0700
@@ -184,7 +184,7 @@ def get_cudnn_version(run_lambda):
         # https://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html#install
         # https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#installmac
         # Use CUDNN_LIBRARY when cudnn library is installed elsewhere.
-        cudnn_cmd = 'ls /usr/local/cuda/lib/libcudnn*'
+        cudnn_cmd = 'ls /opt/cuda/lib/libcudnn*'
     else:
         cudnn_cmd = 'ldconfig -p | grep libcudnn | rev | cut -d" " -f1 | rev'
     rc, out, _ = run_lambda(cudnn_cmd)
diff '--color=auto' -urp pytorch-2.4.0.orig/torch/utils/cpp_extension.py pytorch-2.4.0/torch/utils/cpp_extension.py
--- pytorch-2.4.0.orig/torch/utils/cpp_extension.py	2024-07-09 11:17:43.000000000 -0700
+++ pytorch-2.4.0/torch/utils/cpp_extension.py	2024-08-10 21:28:20.088687164 -0700
@@ -109,7 +109,7 @@ def _find_cuda_home() -> Optional[str]:
                 else:
                     cuda_home = cuda_homes[0]
             else:
-                cuda_home = '/usr/local/cuda'
+                cuda_home = '/opt/cuda'
             if not os.path.exists(cuda_home):
                 cuda_home = None
     if cuda_home and not torch.cuda.is_available():
